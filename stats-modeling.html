<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hiep Tat Bui">

<title>Project MÔ HÌNH HÓA THỐNG KÊ</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="stats-modeling_files/libs/clipboard/clipboard.min.js"></script>
<script src="stats-modeling_files/libs/quarto-html/quarto.js"></script>
<script src="stats-modeling_files/libs/quarto-html/popper.min.js"></script>
<script src="stats-modeling_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="stats-modeling_files/libs/quarto-html/anchor.min.js"></script>
<link href="stats-modeling_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="stats-modeling_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="stats-modeling_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="stats-modeling_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="stats-modeling_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="stats-modeling_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="stats-modeling_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#các-dataset-được-sử-dụng" id="toc-các-dataset-được-sử-dụng" class="nav-link active" data-scroll-target="#các-dataset-được-sử-dụng">CÁC DATASET ĐƯỢC SỬ DỤNG:</a></li>
  <li><a href="#hoạt-động-1" id="toc-hoạt-động-1" class="nav-link" data-scroll-target="#hoạt-động-1">Hoạt động 1</a>
  <ul>
  <li><a href="#task-1" id="toc-task-1" class="nav-link" data-scroll-target="#task-1">Task 1</a>
  <ul class="collapse">
  <li><a href="#tiền-xử-lí-dữ-liệu" id="toc-tiền-xử-lí-dữ-liệu" class="nav-link" data-scroll-target="#tiền-xử-lí-dữ-liệu">Tiền xử lí dữ liệu</a></li>
  <li><a href="#chia-dataset-thành-tập-train-và-tập-validation" id="toc-chia-dataset-thành-tập-train-và-tập-validation" class="nav-link" data-scroll-target="#chia-dataset-thành-tập-train-và-tập-validation">Chia dataset thành tập train và tập validation</a></li>
  <li><a href="#chọn-mô-hình" id="toc-chọn-mô-hình" class="nav-link" data-scroll-target="#chọn-mô-hình">Chọn mô hình</a></li>
  <li><a href="#dự-báo" id="toc-dự-báo" class="nav-link" data-scroll-target="#dự-báo">Dự báo</a></li>
  <li><a href="#so-sánh-kết-quả" id="toc-so-sánh-kết-quả" class="nav-link" data-scroll-target="#so-sánh-kết-quả">So sánh kết quả</a></li>
  <li><a href="#đề-xuất-cải-tiếnphân-tích-khác" id="toc-đề-xuất-cải-tiếnphân-tích-khác" class="nav-link" data-scroll-target="#đề-xuất-cải-tiếnphân-tích-khác">Đề xuất cải tiến/phân tích khác</a></li>
  </ul></li>
  <li><a href="#task-2" id="toc-task-2" class="nav-link" data-scroll-target="#task-2">Task 2</a>
  <ul class="collapse">
  <li><a href="#tiền-xử-lí-dữ-liệu-1" id="toc-tiền-xử-lí-dữ-liệu-1" class="nav-link" data-scroll-target="#tiền-xử-lí-dữ-liệu-1">Tiền xử lí dữ liệu</a></li>
  <li><a href="#phân-tích-phương-sai-anova-nhiều-nhân-tố-đã-chọn" id="toc-phân-tích-phương-sai-anova-nhiều-nhân-tố-đã-chọn" class="nav-link" data-scroll-target="#phân-tích-phương-sai-anova-nhiều-nhân-tố-đã-chọn">Phân tích phương sai ANOVA nhiều nhân tố đã chọn</a>
  <ul class="collapse">
  <li><a href="#thực-hiện-anova-mà-không-quan-tâm-đến-các-giả-định-không-thỏa-mãn." id="toc-thực-hiện-anova-mà-không-quan-tâm-đến-các-giả-định-không-thỏa-mãn." class="nav-link" data-scroll-target="#thực-hiện-anova-mà-không-quan-tâm-đến-các-giả-định-không-thỏa-mãn.">1. Thực hiện ANOVA mà không quan tâm đến các giả định không thỏa mãn.</a></li>
  <li><a href="#thực-hiện-biến-đổi-biến-sau-đó-thực-hiện-phân-tích-anova." id="toc-thực-hiện-biến-đổi-biến-sau-đó-thực-hiện-phân-tích-anova." class="nav-link" data-scroll-target="#thực-hiện-biến-đổi-biến-sau-đó-thực-hiện-phân-tích-anova.">2. Thực hiện biến đổi biến, sau đó thực hiện phân tích ANOVA.</a></li>
  </ul></li>
  <li><a href="#kiểm-tra-các-giả-định-của-mô-hình" id="toc-kiểm-tra-các-giả-định-của-mô-hình" class="nav-link" data-scroll-target="#kiểm-tra-các-giả-định-của-mô-hình">Kiểm tra các giả định của mô hình</a></li>
  <li><a href="#đề-xuất-cải-tiếnphân-tích-khác-1" id="toc-đề-xuất-cải-tiếnphân-tích-khác-1" class="nav-link" data-scroll-target="#đề-xuất-cải-tiếnphân-tích-khác-1">Đề xuất cải tiến/phân tích khác</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#hoạt-động-2" id="toc-hoạt-động-2" class="nav-link" data-scroll-target="#hoạt-động-2">Hoạt động 2</a>
  <ul>
  <li><a href="#giới-thiệu-đề-đề-tài-nguồn-gốc-của-dữ-liệu-giới-thiệu-các-biến" id="toc-giới-thiệu-đề-đề-tài-nguồn-gốc-của-dữ-liệu-giới-thiệu-các-biến" class="nav-link" data-scroll-target="#giới-thiệu-đề-đề-tài-nguồn-gốc-của-dữ-liệu-giới-thiệu-các-biến">Giới thiệu đề “đề tài”, nguồn gốc của dữ liệu, giới thiệu các biến, …</a>
  <ul class="collapse">
  <li><a href="#tiền-xử-lý-số-liệu" id="toc-tiền-xử-lý-số-liệu" class="nav-link" data-scroll-target="#tiền-xử-lý-số-liệu">Tiền xử lý số liệu</a></li>
  <li><a href="#xây-dựng-mô-hình-hồi-quy-tuyến-tính-bộihoặc-anova-2-hay-nhiều-nhân-tố" id="toc-xây-dựng-mô-hình-hồi-quy-tuyến-tính-bộihoặc-anova-2-hay-nhiều-nhân-tố" class="nav-link" data-scroll-target="#xây-dựng-mô-hình-hồi-quy-tuyến-tính-bộihoặc-anova-2-hay-nhiều-nhân-tố">Xây dựng mô hình hồi quy tuyến tính bội/hoặc ANOVA 2 hay nhiều nhân tố</a>
  <ul class="collapse">
  <li><a href="#chia-thành-tập-train-và-tập-validation-với-tỉ-lệ-8020" id="toc-chia-thành-tập-train-và-tập-validation-với-tỉ-lệ-8020" class="nav-link" data-scroll-target="#chia-thành-tập-train-và-tập-validation-với-tỉ-lệ-8020">Chia thành tập train và tập validation với tỉ lệ 80:20</a></li>
  <li><a href="#xây-dựng-mô-hình-hồi-quy-tuyến-tính-bội-với-tất-cả-các-biến" id="toc-xây-dựng-mô-hình-hồi-quy-tuyến-tính-bội-với-tất-cả-các-biến" class="nav-link" data-scroll-target="#xây-dựng-mô-hình-hồi-quy-tuyến-tính-bội-với-tất-cả-các-biến">Xây dựng mô hình hồi quy tuyến tính bội với tất cả các biến</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#kiểm-tra-các-giả-định-của-mô-hình-đã-xây-dựng" id="toc-kiểm-tra-các-giả-định-của-mô-hình-đã-xây-dựng" class="nav-link" data-scroll-target="#kiểm-tra-các-giả-định-của-mô-hình-đã-xây-dựng">Kiểm tra các giả định của mô hình đã xây dựng</a></li>
  <li><a href="#chọn-mô-hình-phù-hợp-nhất" id="toc-chọn-mô-hình-phù-hợp-nhất" class="nav-link" data-scroll-target="#chọn-mô-hình-phù-hợp-nhất">Chọn mô hình phù hợp nhất</a>
  <ul class="collapse">
  <li><a href="#phân-tích-kết-quả" id="toc-phân-tích-kết-quả" class="nav-link" data-scroll-target="#phân-tích-kết-quả">Phân tích kết quả</a></li>
  <li><a href="#đưa-ra-những-phương-phápphân-tích-khác-có-thể-cho-kết-quả-tốt-hơn-nếu-có-thể" id="toc-đưa-ra-những-phương-phápphân-tích-khác-có-thể-cho-kết-quả-tốt-hơn-nếu-có-thể" class="nav-link" data-scroll-target="#đưa-ra-những-phương-phápphân-tích-khác-có-thể-cho-kết-quả-tốt-hơn-nếu-có-thể">Đưa ra những phương pháp/phân tích khác có thể cho kết quả tốt hơn nếu có thể</a></li>
  <li><a href="#kết-luận-4" id="toc-kết-luận-4" class="nav-link" data-scroll-target="#kết-luận-4">Kết luận</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Project MÔ HÌNH HÓA THỐNG KÊ</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hiep Tat Bui </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="các-dataset-được-sử-dụng" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="các-dataset-được-sử-dụng">CÁC DATASET ĐƯỢC SỬ DỤNG:</h2>
<p>Gọi các thư viện cần thiết</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl) </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fastDummies)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PerformanceAnalytics)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nortest)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parsnip)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FSA)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggstatsplot)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(countrycode)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(truncnorm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol type="1">
<li>CSM dataset: Conventional and Social Media Movies</li>
</ol>

<div class="no-row-height column-margin column-container"><div class="">
<p><a href="https://archive.ics.uci.edu/dataset/424/csm+conventional+and+social+media+movies+dataset+2014+and+2015">Nguồn CSM dataset</a></p>
</div></div><div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"./data/CSM.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>insurance dataset: thông tin số tiền bảo hiểm dùng trong y tế</li>
</ol>

<div class="no-row-height column-margin column-container"><div class="">
<p><a href="https://www.kaggle.com/datasets/mirichoi0218/insurance">Nguồn insurance dataset</a></p>
</div></div><div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./data/insurance.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>World university Ranking: Bảng xếp hạng đại học trên thế giới</li>
</ol>

<div class="no-row-height column-margin column-container"><div class="">
<p><a href="https://www.kaggle.com/datasets/rafsunahmad/world-all-university-ranking-factors/data">Nguồn Kaggle</a></p>
</div></div><div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data3 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./data/university_rank.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="hoạt-động-1" class="level1 page-columns page-full">
<h1>Hoạt động 1</h1>
<section id="task-1" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="task-1">Task 1</h2>
<section id="tiền-xử-lí-dữ-liệu" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="tiền-xử-lí-dữ-liệu">Tiền xử lí dữ liệu</h3>
<p>Loại bỏ dữ liệu bị trùng lặp và thực hiện kiểm tra data profiling với thư viện skimr với lệnh <code>skim(data1)</code></p>

<div class="no-row-height column-margin column-container"><div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 14
# ℹ 14 variables: Movie &lt;chr&gt;, Year &lt;dbl&gt;, Ratings &lt;dbl&gt;, Genre &lt;dbl&gt;,
#   Gross &lt;dbl&gt;, Budget &lt;dbl&gt;, Screens &lt;dbl&gt;, Sequel &lt;dbl&gt;, Sentiment &lt;dbl&gt;,
#   Views &lt;dbl&gt;, Likes &lt;dbl&gt;, Dislikes &lt;dbl&gt;, Comments &lt;dbl&gt;,
#   Aggregate Followers &lt;dbl&gt;</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tập dữ liệu không có quan sát bị duplicate"</code></pre>
</div>
</div></div><div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(data1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">data1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">231</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">13</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Movie</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">231</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 7%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Year</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2014.29</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">2014.0</td>
<td style="text-align: right;">2014.0</td>
<td style="text-align: right;">2014.0</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: right;">2015.0</td>
<td style="text-align: left;">▇▁▁▁▃</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ratings</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">6.44</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">3.1</td>
<td style="text-align: right;">5.8</td>
<td style="text-align: right;">6.5</td>
<td style="text-align: right;">7.1</td>
<td style="text-align: right;">8.7</td>
<td style="text-align: left;">▁▂▇▇▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Genre</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">5.36</td>
<td style="text-align: right;">4.14</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">8.0</td>
<td style="text-align: right;">15.0</td>
<td style="text-align: left;">▇▁▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gross</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">68066033.20</td>
<td style="text-align: right;">88902891.22</td>
<td style="text-align: right;">2470.0</td>
<td style="text-align: right;">10300000.0</td>
<td style="text-align: right;">37400000.0</td>
<td style="text-align: right;">89350000.0</td>
<td style="text-align: right;">643000000.0</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Budget</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">47921730.05</td>
<td style="text-align: right;">54288246.07</td>
<td style="text-align: right;">70000.0</td>
<td style="text-align: right;">9000000.0</td>
<td style="text-align: right;">28000000.0</td>
<td style="text-align: right;">65000000.0</td>
<td style="text-align: right;">250000000.0</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">Screens</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">2209.24</td>
<td style="text-align: right;">1463.77</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">449.0</td>
<td style="text-align: right;">2777.0</td>
<td style="text-align: right;">3372.0</td>
<td style="text-align: right;">4324.0</td>
<td style="text-align: left;">▇▁▂▇▅</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sequel</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.36</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">7.0</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sentiment</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.81</td>
<td style="text-align: right;">7.00</td>
<td style="text-align: right;">-38.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">5.5</td>
<td style="text-align: right;">29.0</td>
<td style="text-align: left;">▁▁▇▃▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Views</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">3712851.29</td>
<td style="text-align: right;">4511104.24</td>
<td style="text-align: right;">698.0</td>
<td style="text-align: right;">623302.0</td>
<td style="text-align: right;">2409338.0</td>
<td style="text-align: right;">5217379.5</td>
<td style="text-align: right;">32626778.0</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">Likes</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">12732.54</td>
<td style="text-align: right;">28825.48</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1776.5</td>
<td style="text-align: right;">6096.0</td>
<td style="text-align: right;">15247.5</td>
<td style="text-align: right;">370552.0</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dislikes</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">679.05</td>
<td style="text-align: right;">1243.93</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">105.5</td>
<td style="text-align: right;">341.0</td>
<td style="text-align: right;">697.5</td>
<td style="text-align: right;">13960.0</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">Comments</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1825.70</td>
<td style="text-align: right;">3571.04</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">248.5</td>
<td style="text-align: right;">837.0</td>
<td style="text-align: right;">2137.0</td>
<td style="text-align: right;">38363.0</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Aggregate Followers</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">3038193.45</td>
<td style="text-align: right;">4886278.07</td>
<td style="text-align: right;">1066.0</td>
<td style="text-align: right;">183025.0</td>
<td style="text-align: right;">1052600.0</td>
<td style="text-align: right;">3694500.0</td>
<td style="text-align: right;">31030000.0</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Như vậy tập dữ liệu có 231 quan trắc với 14 biến, không có dữ liệu bị trùng lặp (trong đó có biến Movie là biến character- cần được loại bỏ ra khỏi tập dữ liệu). Tập dữ liệu cho ta thấy có biến Screens, chiếm 4.33% và biến Aggregate_Followers chiếm tỉ lệ 15.15% bị khuyết.</p>

<div class="no-row-height column-margin column-container"><div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(data1, <span class="at">select =</span> <span class="sc">-</span>Movie)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data1)[<span class="dv">13</span>] <span class="ot">=</span> <span class="st">'Aggregate_Followers'</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Year"                "Ratings"             "Genre"              
 [4] "Gross"               "Budget"              "Screens"            
 [7] "Sequel"              "Sentiment"           "Views"              
[10] "Likes"               "Dislikes"            "Comments"           
[13] "Aggregate_Followers"</code></pre>
</div>
</div></div><p>Để xử lí, ta giả định dữ liệu bị khuyết là dạng MAR và sử dụng thuật toán MICE (Multiple Imputation by Chained Equations) để thay thế giá trị bị khuyết. Việc sử dụng method=‘cart’ vì trong tập dữ liệu có biến độc lập là biến định tính. Sau cùng ta kiểm tra lại tập dữ liệu có còn dữ liệu khuyết nào hay không nhờ lệnh colSums(is.na(data1))</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>imputed_Data <span class="ot">&lt;-</span> <span class="fu">mice</span>(data1, <span class="at">method =</span> <span class="st">'cart'</span>, <span class="at">seed =</span> <span class="dv">42</span>, <span class="at">print=</span><span class="cn">FALSE</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">complete</span>(imputed_Data,<span class="at">action=</span><span class="dv">5</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(data1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               Year             Ratings               Genre               Gross 
                  0                   0                   0                   0 
             Budget             Screens              Sequel           Sentiment 
                  0                   0                   0                   0 
              Views               Likes            Dislikes            Comments 
                  0                   0                   0                   0 
Aggregate_Followers 
                  0 </code></pre>
</div>
</div>
<p>Kiểm tra lại sau khi hoàn thành việc xử lí dữ liệu bị khuyết</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      Year         Ratings          Genre            Gross          
 Min.   :2014   Min.   :3.100   Min.   : 1.000   Min.   :     2470  
 1st Qu.:2014   1st Qu.:5.800   1st Qu.: 1.000   1st Qu.: 10300000  
 Median :2014   Median :6.500   Median : 3.000   Median : 37400000  
 Mean   :2014   Mean   :6.442   Mean   : 5.359   Mean   : 68066033  
 3rd Qu.:2015   3rd Qu.:7.100   3rd Qu.: 8.000   3rd Qu.: 89350000  
 Max.   :2015   Max.   :8.700   Max.   :15.000   Max.   :643000000  
     Budget            Screens           Sequel        Sentiment     
 Min.   :7.00e+04   Min.   :   2.0   Min.   :1.000   Min.   :-38.00  
 1st Qu.:9.00e+06   1st Qu.: 372.5   1st Qu.:1.000   1st Qu.:  0.00  
 Median :2.80e+07   Median :2766.0   Median :1.000   Median :  0.00  
 Mean   :4.78e+07   Mean   :2144.6   Mean   :1.359   Mean   :  2.81  
 3rd Qu.:6.50e+07   3rd Qu.:3360.5   3rd Qu.:1.000   3rd Qu.:  5.50  
 Max.   :2.50e+08   Max.   :4324.0   Max.   :7.000   Max.   : 29.00  
     Views              Likes           Dislikes          Comments      
 Min.   :     698   Min.   :     1   Min.   :    0.0   Min.   :    0.0  
 1st Qu.:  623302   1st Qu.:  1776   1st Qu.:  105.5   1st Qu.:  248.5  
 Median : 2409338   Median :  6096   Median :  341.0   Median :  837.0  
 Mean   : 3712851   Mean   : 12732   Mean   :  679.1   Mean   : 1825.7  
 3rd Qu.: 5217380   3rd Qu.: 15248   3rd Qu.:  697.5   3rd Qu.: 2137.0  
 Max.   :32626778   Max.   :370552   Max.   :13960.0   Max.   :38363.0  
 Aggregate_Followers
 Min.   :    1066   
 1st Qu.:  147000   
 Median :  888000   
 Mean   : 2983497   
 3rd Qu.: 3406000   
 Max.   :31030000   </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   231 obs. of  13 variables:
 $ Year               : num  2014 2014 2014 2014 2014 ...
 $ Ratings            : num  6.3 7.1 6.2 6.3 4.7 4.6 6.1 7.1 6.5 6.1 ...
 $ Genre              : num  8 1 1 1 8 3 8 1 10 8 ...
 $ Gross              : num  9.13e+03 1.92e+08 3.07e+07 1.06e+08 1.73e+07 2.90e+04 4.26e+07 5.75e+06 2.60e+07 4.86e+07 ...
 $ Budget             : num  4.00e+06 5.00e+07 2.80e+07 1.10e+08 3.50e+06 5.00e+05 4.00e+07 2.00e+07 2.80e+07 1.25e+07 ...
 $ Screens            : num  45 3306 2872 3470 2310 ...
 $ Sequel             : num  1 2 1 2 2 1 1 1 1 1 ...
 $ Sentiment          : num  0 2 0 0 0 0 0 2 3 0 ...
 $ Views              : num  3280543 583289 304861 452917 3145573 ...
 $ Likes              : num  4632 3465 328 2429 12163 ...
 $ Dislikes           : num  425 61 34 132 610 7 419 197 419 532 ...
 $ Comments           : num  636 186 47 590 1082 ...
 $ Aggregate_Followers: num  1120000 12350000 483000 568000 1923800 ...</code></pre>
</div>
</div>
</section>
<section id="chia-dataset-thành-tập-train-và-tập-validation" class="level3">
<h3 class="anchored" data-anchor-id="chia-dataset-thành-tập-train-và-tập-validation">Chia dataset thành tập train và tập validation</h3>
<p>Ta tạo biến giả (dummies) cho biến độc lập Genre (thể loại phim). Ta sử dụng package “fastDummies”)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">dummy_cols</span>(data1, <span class="at">select_columns =</span> <span class="st">'Genre'</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Loại bỏ biến Genre sau khi tạo biến giả</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(data1, <span class="at">select =</span> <span class="sc">-</span>Genre)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Tạo tập train và tập validation với tỉ lệ 80-20</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Tạo id column</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data1)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#sử dụng 80% cho tập training và 20% cho tập validation</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> data1 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">sample_frac</span>(<span class="fl">0.8</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>val  <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">anti_join</span>(data1, train, <span class="at">by =</span> <span class="st">'id'</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">subset</span>(train, <span class="at">select =</span> <span class="sc">-</span>id)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>val <span class="ot">&lt;-</span> <span class="fu">subset</span>(val, <span class="at">select =</span> <span class="sc">-</span>id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Kiểm tra nhanh với biểu đồ boxplot ở từng biến dữ liệu (không thực hiện với biến Year (chỉ có giá trị 2014-2015) và Genre (biến định tính)), ta thấy ở cả tập train và val có khá nhiều outlier, kể cả biến phụ thuộc ta quan tâm.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="stats-modeling_files/figure-html/pressure-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="stats-modeling_files/figure-html/pressure-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Tuy nhiên sử dụng biểu đồ có thể khiến ta mất thông tin. Kiểm tra cụ thể đếm số lượng outlier ở từng cột với lệnh <code>length(boxplot.stats(train$COLUMN_NAME)$out)</code>, ta nhận được kết quả là ngoại trừ biến <code>Screens</code>, còn lại tất cả đều có xuất hiện outlier.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Số lượng outlier ở từng biến
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">boxplot.stats</span>(train<span class="sc">$</span>Ratings)<span class="sc">$</span>out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">boxplot.stats</span>(train<span class="sc">$</span>Gross)<span class="sc">$</span>out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">boxplot.stats</span>(train<span class="sc">$</span>Budget)<span class="sc">$</span>out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">boxplot.stats</span>(train<span class="sc">$</span>Screens)<span class="sc">$</span>out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">boxplot.stats</span>(train<span class="sc">$</span>Sequel)<span class="sc">$</span>out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 35</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">boxplot.stats</span>(train<span class="sc">$</span>Sentiment))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">boxplot.stats</span>(train<span class="sc">$</span>Views)<span class="sc">$</span>out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">boxplot.stats</span>(train<span class="sc">$</span>Likes)<span class="sc">$</span>out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">boxplot.stats</span>(train<span class="sc">$</span>Dislikes)<span class="sc">$</span>out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">boxplot.stats</span>(train<span class="sc">$</span>Comments)<span class="sc">$</span>out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">boxplot.stats</span>(train<span class="sc">$</span>Aggregate_Followers)<span class="sc">$</span>out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Số lượng outlier ở từng biến là khá nhiều, việc xuất hiện outlier có thể sẽ ảnh hưởng đến tính chuẩn ở từng biến dữ liệu (có thể cần xem xét thực hiện biến đổi biến nếu các giả định không thỏa khi xây dựng mô hình). Ngoài ra, Việc loại bỏ outlier cũng không có thể dẫn đến việc mất nhiều thông tin từ tập huấn luyện. Outlier ở các biến độc lập có thể ảnh hưởng đến giá trị của biến phụ thuộc (doanh thu). Vì vậy thay vì loại bỏ các outlier trên, ta quyết định sẽ giữ các giá trị outlier lại.</p>
</section>
<section id="chọn-mô-hình" class="level3">
<h3 class="anchored" data-anchor-id="chọn-mô-hình">Chọn mô hình</h3>
<p>Trước hết tiến hành xây dựng một mô hình hồi quy tuyến tính, sau đó sẽ tiến hành kiểm tra các giả định của mô hình, ví dụ như kiểm tra tính chuẩn, trung bình và phương sai,…</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(Gross <span class="sc">~</span> ., <span class="at">data =</span> train)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Gross ~ ., data = train)

Residuals:
       Min         1Q     Median         3Q        Max 
-129566584  -30389057   -4381397   20855519  411235192 

Coefficients: (1 not defined because of singularities)
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         -5.256e+09  2.358e+10  -0.223 0.823923    
Year                 2.544e+06  1.171e+07   0.217 0.828242    
Ratings              2.090e+07  5.607e+06   3.728 0.000266 ***
Budget               7.226e-01  1.290e-01   5.600 8.94e-08 ***
Screens              1.233e+04  4.223e+03   2.920 0.003996 ** 
Sequel               1.028e+07  5.383e+06   1.910 0.057922 .  
Sentiment           -5.884e+05  7.021e+05  -0.838 0.403248    
Views               -2.401e+00  1.949e+00  -1.232 0.219729    
Likes                6.554e+02  4.320e+02   1.517 0.131242    
Dislikes             1.364e+04  6.179e+03   2.208 0.028663 *  
Comments            -4.411e+03  3.720e+03  -1.186 0.237462    
Aggregate_Followers  2.238e+00  9.924e-01   2.255 0.025474 *  
Genre_1             -4.218e+05  2.747e+07  -0.015 0.987766    
Genre_2             -2.499e+07  3.259e+07  -0.767 0.444308    
Genre_3             -2.566e+07  2.744e+07  -0.935 0.351106    
Genre_4             -6.465e+07  6.731e+07  -0.961 0.338191    
Genre_6             -3.849e+07  4.350e+07  -0.885 0.377544    
Genre_7              8.084e+06  4.983e+07   0.162 0.871320    
Genre_8             -2.009e+07  2.667e+07  -0.753 0.452429    
Genre_9             -1.582e+07  3.340e+07  -0.474 0.636405    
Genre_10            -3.202e+07  3.298e+07  -0.971 0.333143    
Genre_12            -1.773e+07  3.386e+07  -0.524 0.601334    
Genre_15                    NA         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 61060000 on 163 degrees of freedom
Multiple R-squared:  0.6293,    Adjusted R-squared:  0.5815 
F-statistic: 13.18 on 21 and 163 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Xây dựng mô hình hồi quy tuyến tính giữa Gross và tất cả các biến
</div>
</div>
<div class="callout-body-container callout-body">
<p>Đặt giả thuyết:</p>
<ul>
<li><strong>H0</strong>: <span class="math inline">{\beta _i} = 0,\forall i</span><br>
</li>
<li><strong>H1</strong>: <span class="math inline">\exists {\beta _i} \ne 0</span><br>
Với p-value: &lt; 2.2e-16 ở kết quả trên, kết luận bác bỏ H0, tồn tại ít nhất 1 <span class="math inline">{\beta _i} \ne 0</span>. Vì vậy, ta xây dựng mô hình thứ 2, lần này chỉ có các biến có ý nghĩa với p_value &lt; 0.05: <code>Ratings</code> <code>Budget</code> <code>Screens</code> <code>Dislikes</code> <code>Aggregate_Followers</code></li>
</ul>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Gross <span class="sc">~</span> Ratings <span class="sc">+</span> Budget <span class="sc">+</span> Screens <span class="sc">+</span> Dislikes <span class="sc">+</span> Aggregate_Followers, <span class="at">data =</span> train)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Gross ~ Ratings + Budget + Screens + Dislikes + 
    Aggregate_Followers, data = train)

Residuals:
       Min         1Q     Median         3Q        Max 
-136114719  -28220540   -6345914   18750011  434188530 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         -1.243e+08  3.125e+07  -3.977 0.000101 ***
Ratings              1.737e+07  4.787e+06   3.628 0.000373 ***
Budget               8.257e-01  1.065e-01   7.752 6.56e-13 ***
Screens              1.448e+04  3.927e+03   3.688 0.000299 ***
Dislikes             5.370e+03  3.528e+03   1.522 0.129694    
Aggregate_Followers  2.390e+00  9.024e-01   2.648 0.008810 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 60870000 on 179 degrees of freedom
Multiple R-squared:  0.5954,    Adjusted R-squared:  0.5841 
F-statistic: 52.69 on 5 and 179 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Tuy mô hình 2 cho được kết quả F-statistic lớn hơn (52.69 &gt; 13.18), cho thấy mô hình 2 phù hợp hơn mô hình 1. Tuy nhiên, p_value ở biến Dislike có giá trị p_value &gt; 0.05. Ta tiếp tục loại bỏ biến này khỏi mô hình và chạy lại và gọi đây là mô hình 3</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Gross <span class="sc">~</span> Ratings <span class="sc">+</span> Budget <span class="sc">+</span> Screens <span class="sc">+</span> Aggregate_Followers, <span class="at">data =</span> train)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Gross ~ Ratings + Budget + Screens + Aggregate_Followers, 
    data = train)

Residuals:
       Min         1Q     Median         3Q        Max 
-139692835  -29482749   -6592906   17609432  434853020 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         -1.130e+08  3.046e+07  -3.708 0.000278 ***
Ratings              1.577e+07  4.688e+06   3.364 0.000938 ***
Budget               8.243e-01  1.069e-01   7.710 8.22e-13 ***
Screens              1.575e+04  3.852e+03   4.087 6.57e-05 ***
Aggregate_Followers  2.433e+00  9.053e-01   2.688 0.007865 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 61100000 on 180 degrees of freedom
Multiple R-squared:  0.5902,    Adjusted R-squared:  0.5811 
F-statistic:  64.8 on 4 and 180 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Kết quả cho thấy mô hình 3 lại tiếp tục tốt hơn mô hình 2 với F-statistic: 64.8. Kiểm tra hệ số tương quan pearson giữa các biến, không xuất hiện trường hợp độc lập tuyến tính.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="stats-modeling_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Kiểm tra liệu mô hình có xảy ra đa cộng tuyến hay không. Kết quả cho thấy Không có đa cộng tuyến xảy ra.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Ratings              Budget             Screens Aggregate_Followers 
           1.133086            1.764629            1.627973            1.043779 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lưu ý
</div>
</div>
<div class="callout-body-container callout-body">
<p>Kiểm tra các giả định của mô hình bao gồm:<br>
+ Biến phụ thuộc Y và các biến độc lập X có mối quan hệ tuyến tính (có)<br>
+ Không xảy ra đa cộng tuyến (đã kiểm tra)<br>
+ Sai số có phân phối chuẩn với trung bình sai số = 0 và phương sai không thay đổi</p>
</div>
</div>
<p>Tiến hành kiểm tra về giả định thứ 3</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">resid</span>(mod3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  resid(mod3)
W = 0.81476, p-value = 4.62e-14</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
1. Kiểm tra sai số có tuân theo phân phối chuẩn hay không
</div>
</div>
<div class="callout-body-container callout-body">
<p>Đặt giả thuyết:</p>
<p><strong>H0</strong>: <span class="math inline">{\varepsilon _i}</span> có phân phối chuẩn<br>
<strong>H1</strong>: <span class="math inline">{\varepsilon _i}</span> không có phân phối chuẩn</p>
<p>Ta bác bỏ H0, p-value &lt; 0.05 <strong>sai số của mô hình không có phân phối chuẩn</strong></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(<span class="fu">resid</span>(mod3), <span class="at">mu =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  resid(mod3)
t = -1.0245e-17, df = 184, p-value = 1
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 -8765302  8765302
sample estimates:
    mean of x 
-4.551406e-11 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
2. Kiểm tra giả định trung bình sai số <span class="math inline">\mu = 0</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Đặt giả thuyết:</p>
<p><strong>H0</strong>: <span class="math inline">{\rm E}({\varepsilon _i}) = 0</span><br>
<strong>H1</strong>: <span class="math inline">{\rm E}({\varepsilon _i}) \ne 0</span></p>
<p>p_value = 1, không bác bỏ H0. <strong>Trung bình sai số thỏa mãn</strong> <span class="math inline">{\rm E}({\varepsilon _i}) = 0</span></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncvTest</span>(mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 113.0811, Df = 1, p = &lt; 2.22e-16</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
3. Kiểm tra tính ổn định của phương sai
</div>
</div>
<div class="callout-body-container callout-body">
<p>Đặt giả thuyết</p>
<p><strong>H0</strong>: phương sai không thay đổi<br>
<strong>H1</strong>: phương sai thay đổi</p>
<p>Ta bác bỏ H0 với p_value &lt; 2.22e-16 &lt; 0.05. <strong>Mô hình không thỏa mãn tính ổn định của phương sai</strong>, phương sai của sai số thay đổi.</p>
</div>
</div>
<p><strong>Như vậy</strong>, mô hình không thỏa mãn tính ổn định của phương sai cũng như không có phân phối chuẩn. Việc không thỏa các giả định khiến cho mô hình không đáng tin cậy cho việc ước lượng. Vì vậy cần thực hiện các phép biến đổi biến (trasformation) với phương pháp Box-Cox.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">powerTransform</span>(<span class="fu">cbind</span>(Gross, Ratings, Budget, Screens, Aggregate_Followers) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> train)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>bcPower Transformations to Multinormality 
                    Est Power Rounded Pwr Wald Lwr Bnd Wald Upr Bnd
Gross                  0.2652        0.27       0.2175       0.3130
Ratings                1.8945        2.00       1.1780       2.6111
Budget                 0.2109        0.21       0.1339       0.2879
Screens                0.6107        0.50       0.4938       0.7276
Aggregate_Followers    0.1402        0.14       0.0803       0.2001

Likelihood ratio test that transformation parameters are equal to 0
 (all log transformations)
                                   LRT df       pval
LR test, lambda = (0 0 0 0 0) 331.9279  5 &lt; 2.22e-16

Likelihood ratio test that no transformations are needed
                                   LRT df       pval
LR test, lambda = (1 1 1 1 1) 1201.682  5 &lt; 2.22e-16</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Likelihood ratio test that transformation parameters are equal to 0
</div>
</div>
<div class="callout-body-container callout-body">
<p>Để kiểm định việc có nên thực hiện phép biến đổi log-transformation với tất cả các biến hay không. Đặt giả thuyết: <br> <br> <strong>H0</strong>: Cần thực hiện phép biến đổi log-transformation cho tất cả các biến<br>
<strong>H1</strong>: Không cần thực hiện phép biến đổi log-transformation cho tất cả các biến<br>
Với p_value &lt; 2.22e-16. Bác bỏ H0, ta <strong>không cần thực hiện phép biến đổi log-transformation cho tất cả các biến</strong>.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Likelihood ratio test that no transformations are needed
</div>
</div>
<div class="callout-body-container callout-body">
<p>Để kiểm định việc có nên thực hiện phép biến đổi biến hay không. Đặt giả thuyết: <br> <br> <strong>H0</strong>: Không cần thực hiện phép transformation<br>
<strong>H1</strong>: Cần thực hiện tối thiểu một phép transformation<br>
Với p_value &lt; 2.22e-16. Bác bỏ H0, ta <strong>cần thực hiện tối thiểu một phép transformation</strong>. Như vậy ta quyết định <strong>thực hiện biến đổi biến với tất cả các giá trị lambda được đề xuất (Rounded Pwr)</strong></p>
</div>
</div>
<p>Thực hiện biến đổi biến theo phương pháp Box-Cox với lambda được đề xuất và xây dựng mô hình</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rút ra các cột trong tập train và biến đổi biến</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>subset <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> <span class="fu">select</span>(Gross, Ratings, Budget, Screens, Aggregate_Followers)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>subset<span class="sc">$</span>Gross <span class="ot">&lt;-</span> subset<span class="sc">$</span>Gross<span class="sc">^</span>(<span class="fl">0.27</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>subset<span class="sc">$</span>Ratings <span class="ot">&lt;-</span> subset<span class="sc">$</span>Ratings<span class="sc">^</span>(<span class="dv">2</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>subset<span class="sc">$</span>Budget <span class="ot">&lt;-</span> subset<span class="sc">$</span>Budget<span class="sc">^</span>(<span class="fl">0.21</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>subset<span class="sc">$</span>Screens <span class="ot">&lt;-</span> subset<span class="sc">$</span>Screens<span class="sc">^</span>(<span class="fl">0.5</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>subset<span class="sc">$</span>Aggregate_Followers <span class="ot">&lt;-</span> subset<span class="sc">$</span>Aggregate_Followers<span class="sc">^</span>(<span class="fl">0.14</span>)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Gross <span class="sc">~</span> Ratings <span class="sc">+</span> Budget <span class="sc">+</span> Screens <span class="sc">+</span> Aggregate_Followers, <span class="at">data =</span> subset)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Gross ~ Ratings + Budget + Screens + Aggregate_Followers, 
    data = subset)

Residuals:
     Min       1Q   Median       3Q      Max 
-116.948  -17.339   -1.117   14.680   75.103 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         -48.6901    10.7619  -4.524 1.10e-05 ***
Ratings               0.7196     0.1744   4.127 5.60e-05 ***
Budget                1.8055     0.2748   6.570 5.23e-10 ***
Screens               1.0563     0.1224   8.629 3.19e-15 ***
Aggregate_Followers   2.3670     1.1044   2.143   0.0334 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 28.55 on 180 degrees of freedom
Multiple R-squared:  0.6881,    Adjusted R-squared:  0.6812 
F-statistic: 99.29 on 4 and 180 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Kiểm tra lại các giả định</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  resid(mod3)
W = 0.98244, p-value = 0.02009</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
1. Giả thiết:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>H0</strong>: <span class="math inline">{\varepsilon _i}</span> có phân phối chuẩn<br>
<strong>H1</strong>: <span class="math inline">{\varepsilon _i}</span> không có phân phối chuẩn</p>
<p>Ta bác bỏ H0, p-value &lt; 0.05 <strong>sai số của mô hình không có phân phối chuẩn</strong>. Tuy nhiên p_value ở mô hình này đã cải thiện từ 4.62e-14 ở mô hình cũ lên p_value = 0.02009</p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  resid(mod3)
t = 1.0978e-16, df = 184, p-value = 1
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 -4.096356  4.096356
sample estimates:
   mean of x 
2.279333e-16 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
2. Kiểm tra giả định trung bình sai số <span class="math inline">\mu = 0</span>.
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>H0</strong>: <span class="math inline">{\rm E}({\varepsilon _i}) = 0</span><br>
<strong>H1</strong>: <span class="math inline">{\rm E}({\varepsilon _i}) \ne 0</span></p>
<p>p_value = 1, không bác bỏ H0. Trung bình sai số thỏa mãn <span class="math inline">{\rm E}({\varepsilon _i}) = 0</span></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.6057082, Df = 1, p = 0.43641</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
3. Kiểm tra tính ổn định của phương sai
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>H0</strong>: phương sai không thay đổi<br>
<strong>H1</strong>: phương sai thay đổi</p>
<p>Chấp nhận H0 với p = 0.43641 &gt; 0.05. Mô hình thỏa mãn tính ổn định của phương sai.</p>
</div>
</div>
<p><strong>Như vậy</strong>, sau khi thực hiện biến đổi biến ở các biến độc lập cũng như biến phụ thuộc, đã khắc phục được giả định về tính ổn định của phương sai sai số. Tuy nhiên giả định về tính chuẩn của sai số vẫn chưa khắc phục được mặc dù đã có sự cải thiện đáng kể về giá trị của p_value.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Kết luận
</div>
</div>
<div class="callout-body-container callout-body">
<p>Như vậy với R^2 hiệu chỉnh = 68.12%, mô hình có các biến độc lập giải thích được cho 68.12% sự biến thiên của biến phụ thuộc. Mô hình cũng không xảy ra hiện tượng đa cộng tuyến giữa các biến độc lập. Tuy nhiên, mô hình vẫn chưa thỏa mãn giả định về tính chuẩn của sai số.</p>
</div>
</div>
</section>
<section id="dự-báo" class="level3">
<h3 class="anchored" data-anchor-id="dự-báo">Dự báo</h3>
<p>Để thực hiện được dự báo phù hợp mô hình với tập validation, ta sẽ biến đổi biến ở tập validation theo các giá trị lambda đã được đề xuất ở trên. Sau đó sử dụng mô hình đã được xây dựng để dự báo giá trị Gross ở tập validation. Tập validation với các biến độc lập sau khi được biến đổi biến có tên là <code>val_subset</code>:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  Ratings   Budget   Screens Aggregate_Followers
1   37.21 39.48504 56.196085            9.280779
2   50.41 34.13629 28.600699            5.203046
3   47.61 27.38234  5.567764            5.117720
4   62.41 53.17061 61.326992            5.521834
5   42.25 39.48504 59.623821            7.828143
6   64.00 24.34628 27.766887            5.046224</code></pre>
</div>
</div>
<p>Thực hiện dự báo mô hình</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod3, <span class="at">newdata =</span> val_subset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="so-sánh-kết-quả" class="level3">
<h3 class="anchored" data-anchor-id="so-sánh-kết-quả">So sánh kết quả</h3>
<p>Trả lại giá trị ban đầu của biến y dự báo và tính MSE của mô hình</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> y_hat<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="fl">0.27</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>MSE <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span><span class="fu">dim</span>(val)[<span class="dv">1</span>])<span class="sc">*</span><span class="fu">sum</span>((val<span class="sc">$</span>Gross <span class="sc">-</span> y_hat)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>MSE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.253642e+15</code></pre>
</div>
</div>
<p>So sánh kết quả dự báo với giá trị thực tế của Gross ta có được MSE = 1.2536424^{15}.</p>
</section>
<section id="đề-xuất-cải-tiếnphân-tích-khác" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="đề-xuất-cải-tiếnphân-tích-khác">Đề xuất cải tiến/phân tích khác</h3>
<p>Mặc dù đã cố gắng sử dụng các phép biến đổi biến, tuy nhiên mô hình hồi quy tuyến tính được xây dựng vẫn chưa đáp ứng được giả định về tính chuẩn của sai số.<br>
Vì vậy cần có một cách tiếp cận khác đó chính là sử dụng <strong>Thống kê phi tham số</strong>, vì lúc này ta không cần đưa ra các giả định về phân phối tổng thể của tập dữ liệu.<br>
Điểm mạnh của thống kê phi tham số là chống nhiễu tốt (outlier- tập dữ liệu này có nhiều giá trị outlier), giảm thời gian xây dựng mô hình khi không cần kiểm tra các giả định phân phối của dữ liệu, thực hiện biến đổi biến… Thực hiện thử nghiệm mô hình cây quyết định (Decision Tree). Ngoài ra ta thực hiện thêm với mô hình XGBoots- một mô hình tree based (tối ưu tuning parameter với Grid-search). Các mô hình được sử dụng với package <code>tidyverse</code>, <code>caret</code>. Lưu ý: lệnh train sử dụng từ package <code>parsnip</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>tree_model <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">min_n=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(.,<span class="st">"regression"</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>tree_fit <span class="ot">&lt;-</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  tree_model <span class="sc">%&gt;%</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Gross <span class="sc">~</span> ., <span class="at">data=</span>train)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  val <span class="sc">%&gt;%</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Gross) <span class="sc">%&gt;%</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(tree_fit,val))</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>MSE_tree <span class="ot">&lt;-</span> <span class="fu">mean</span>((result<span class="sc">$</span>Gross <span class="sc">-</span> result<span class="sc">$</span>.pred)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>MSE_tree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.561262e+15</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">=</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">search =</span> <span class="st">"grid"</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tạo thông số để thực hiện Grid search</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>gbmGrid <span class="ot">&lt;-</span>  <span class="fu">expand.grid</span>(<span class="at">max_depth =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>), </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nrounds =</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)<span class="sc">*</span><span class="dv">50</span>,    <span class="co"># số lượng cây</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># cài đặt các value mặc định</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">eta =</span> <span class="fl">0.3</span>,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">gamma =</span> <span class="dv">0</span>,</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">subsample =</span> <span class="dv">1</span>,</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">min_child_weight =</span> <span class="dv">1</span>,</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colsample_bytree =</span> <span class="fl">0.6</span>)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="co"># huấn luyện mô hình XGboost Regression tree model</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> (<span class="fu">train</span>(Gross<span class="sc">~</span>., </span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"xgbTree"</span>, </span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">trControl =</span> train_control, </span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">tuneGrid =</span> gbmGrid, <span class="at">verbosity =</span> <span class="dv">0</span>))</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a><span class="co"># xuất kết quả mô hình tốt nhất cho XGboots</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>eXtreme Gradient Boosting 

185 samples
 22 predictor

No pre-processing
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 149, 148, 148, 148, 147 
Resampling results across tuning parameters:

  max_depth  nrounds  RMSE      Rsquared   MAE     
  3           50      61975953  0.6169252  39683384
  3          100      61746305  0.6185664  39515125
  3          150      61849891  0.6174749  39582091
  3          200      61877059  0.6170806  39607583
  3          250      61885586  0.6169987  39608714
  3          300      61887569  0.6169503  39610111
  3          350      61889671  0.6169190  39613205
  3          400      61889770  0.6169175  39613060
  3          450      61890051  0.6169130  39613340
  3          500      61890162  0.6169120  39613391
  5           50      66988113  0.5754052  37500126
  5          100      67010667  0.5751568  37526255
  5          150      67011281  0.5751496  37526960
  5          200      67011276  0.5751498  37526926
  5          250      67011281  0.5751497  37526929
  5          300      67011287  0.5751496  37526931
  5          350      67011289  0.5751496  37526931
  5          400      67011293  0.5751496  37526932
  5          450      67011297  0.5751495  37526933
  5          500      67011301  0.5751495  37526935
  7           50      64929797  0.5979004  40214632
  7          100      64930157  0.5978808  40214599
  7          150      64930166  0.5978807  40214612
  7          200      64930174  0.5978806  40214617
  7          250      64930182  0.5978806  40214623
  7          300      64930195  0.5978805  40214629
  7          350      64930204  0.5978804  40214633
  7          400      64930213  0.5978803  40214638
  7          450      64930221  0.5978802  40214642
  7          500      64930227  0.5978801  40214645

Tuning parameter 'eta' was held constant at a value of 0.3
Tuning

Tuning parameter 'min_child_weight' was held constant at a value of 1

Tuning parameter 'subsample' was held constant at a value of 1
RMSE was used to select the optimal model using the smallest value.
The final values used for the model were nrounds = 100, max_depth = 3, eta
 = 0.3, gamma = 0, colsample_bytree = 0.6, min_child_weight = 1 and subsample
 = 1.</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ghi chú
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dựa trên kết quả MSE, ta thấy được ở tập dữ liệu này Mô hình hồi quy tuyến tính cho kết quả tốt nhất với MSE = 1.2536424^{15} dù rằng không thỏa các giả định. Trong khi đó mô hình cây quyết định cho kết quả MSE = 2.561262^{15} và mô hình XGBoots cho kết quả MSE = 1.6306327^{15}. Tuy nhiên, ta cho rằng nếu thu thập nhiều dữ liệu hơn, thì các mô hình Decision Tree và XGBoots có thể sẽ cho kết quả tốt hơn.</p>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Linear Regression: MSE"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.253642e+15</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Decision Tree: MSE"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.561262e+15</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "XGboost: MSE"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.630633e+15</code></pre>
</div>
</div></div></section>
</section>
<section id="task-2" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="task-2">Task 2</h2>
<section id="tiền-xử-lí-dữ-liệu-1" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="tiền-xử-lí-dữ-liệu-1">Tiền xử lí dữ liệu</h3>

<div class="no-row-height column-margin column-container"><div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>data2[<span class="fu">duplicated</span>(data2),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
    age sex     bmi children smoker region    charges
  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;       &lt;dbl&gt;
1    19 male   30.6        0 no     northwest   1640.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Dữ liệu bị trùng 1 quan sát'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Dữ liệu bị trùng 1 quan sát"</code></pre>
</div>
</div></div><p>Có 1 quan sát bị trùng, quyết định loại bỏ quan sát này. Kiểm tra data profiling với <code>skimr</code></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> data2 <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">data2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">1337</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">smoker</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">region</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">39.22</td>
<td style="text-align: right;">14.04</td>
<td style="text-align: right;">18.00</td>
<td style="text-align: right;">27.00</td>
<td style="text-align: right;">39.00</td>
<td style="text-align: right;">51.00</td>
<td style="text-align: right;">64.00</td>
<td style="text-align: left;">▇▅▅▆▆</td>
</tr>
<tr class="even">
<td style="text-align: left;">bmi</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">30.66</td>
<td style="text-align: right;">6.10</td>
<td style="text-align: right;">15.96</td>
<td style="text-align: right;">26.29</td>
<td style="text-align: right;">30.40</td>
<td style="text-align: right;">34.70</td>
<td style="text-align: right;">53.13</td>
<td style="text-align: left;">▂▇▇▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">children</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.10</td>
<td style="text-align: right;">1.21</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: left;">▇▂▂▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">charges</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13279.12</td>
<td style="text-align: right;">12110.36</td>
<td style="text-align: right;">1121.87</td>
<td style="text-align: right;">4746.34</td>
<td style="text-align: right;">9386.16</td>
<td style="text-align: right;">16657.72</td>
<td style="text-align: right;">63770.43</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Sau khi loại bỏ quan sát bị trùng, có 1337 quan sát với 7 biến độc lập. Dữ liệu không có missing value, để thực hiện phân tích ANOVA k nhân tố, ta thực hiện chuyển đối một số biến.</p>
<ul>
<li>Đối với biến <code>age</code>, ta quyết định chia thành 3 nhóm: <code>age &lt; 30</code>, <code>30 &lt;= age &lt; 60</code>, <code>age &gt;= 60</code></li>
</ul>

<div class="no-row-height column-margin column-container"><div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>data2<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">cut</span>(data2<span class="sc">$</span>age, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="cn">Inf</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"age &lt; 30"</span>, <span class="st">"30 &lt;= age &lt; 60"</span>, <span class="st">"age &gt;= 60"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div><ul>
<li>Đối với biến <code>bmi</code>, ta quyết định chia thành 3 nhóm: <code>bmi &lt; 25</code>, <code>25 &lt;= bmi &lt; 35</code>, <code>bmi &gt;= 35</code></li>
</ul>

<div class="no-row-height column-margin column-container"><div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>data2<span class="sc">$</span>bmi <span class="ot">&lt;-</span> <span class="fu">cut</span>(data2<span class="sc">$</span>bmi, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">35</span>, <span class="cn">Inf</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"bmi &lt; 25"</span>, <span class="st">"25 &lt;= bmi &lt; 35"</span>, <span class="st">"bmi &gt;= 35"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div><ul>
<li>Đối với biến <code>children</code>, ta quyết định chia thành 3 nhóm: <code>0 or 1 child</code>, <code>2 childs</code>, <code>&gt; 2 childs</code></li>
</ul>

<div class="no-row-height column-margin column-container"><div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>data2<span class="sc">$</span>children <span class="ot">&lt;-</span> <span class="fu">cut</span>(data2<span class="sc">$</span>children, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="cn">Inf</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0 or 1 child"</span>, <span class="st">"2 childs"</span>, <span class="st">"&gt; 2 childs"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div><p>Thực hiện biến đổi factor với các biến. Sau khi thực hiện ta có được (có khoảng 6 nhân tố)</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>tibble [1,337 × 7] (S3: tbl_df/tbl/data.frame)
 $ age     : Factor w/ 3 levels "age &lt; 30","30 &lt;= age &lt; 60",..: 1 1 1 2 2 2 2 2 2 2 ...
 $ sex     : Factor w/ 2 levels "female","male": 1 2 2 2 2 1 1 1 2 1 ...
 $ bmi     : Factor w/ 3 levels "bmi &lt; 25","25 &lt;= bmi &lt; 35",..: 2 2 2 2 2 2 2 2 2 2 ...
 $ children: Factor w/ 3 levels "0 or 1 child",..: 1 1 3 1 1 1 1 3 2 1 ...
 $ smoker  : Factor w/ 2 levels "no","yes": 2 1 1 1 1 1 1 1 1 1 ...
 $ region  : Factor w/ 4 levels "northeast","northwest",..: 4 3 3 2 2 3 3 2 1 2 ...
 $ charges : num [1:1337] 16885 1726 4449 21984 3867 ...</code></pre>
</div>
</div>
</section>
<section id="phân-tích-phương-sai-anova-nhiều-nhân-tố-đã-chọn" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="phân-tích-phương-sai-anova-nhiều-nhân-tố-đã-chọn">Phân tích phương sai ANOVA nhiều nhân tố đã chọn</h3>
<p>Trải qua quá trình tiền xử lí dữ liệu trên, ta có 6 nhân tố cần thực hiện phân tích ANOVA nhiều nhân tố bao gồm [<code>sex</code>, <code>smoker</code> <code>region</code> <code>age</code> <code>bmi</code> <code>children</code>] (lí do chọn 6 nhân tố: để có thể phân tích, khai thác tối đa các thông tin từ bộ dữ liệu đem lại). Vì vậy trước khi thực hiện ANOVA, tiến hành các giả định của 1 mô hình ANOVA nhiều nhân tố gồm:</p>
<ul>
<li>Các mẫu phải độc lập: trong dữ liệu này thì các quan sát đều được ghi nhận độc lập.<br>
</li>
<li>Biến phụ thuộc <code>charges</code> là biến liên tục.<br>
</li>
<li>Các nhóm phải có phân phối chuẩn hoặc gần chuẩn.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>av_residual <span class="ot">&lt;-</span> (<span class="fu">rstandard</span>(<span class="fu">aov</span>(data2<span class="sc">$</span>charges <span class="sc">~</span> data2<span class="sc">$</span>age <span class="sc">+</span> data2<span class="sc">$</span>sex <span class="sc">+</span> data2<span class="sc">$</span>bmi </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>                              <span class="sc">+</span> data2<span class="sc">$</span>children <span class="sc">+</span> data2<span class="sc">$</span>smoker <span class="sc">+</span> data2<span class="sc">$</span>region)))</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(av_residual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  av_residual
W = 0.92949, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Đặt giả thuyết:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>H0</strong>: Dữ liệu có phân phối chuẩn<br>
<strong>H1</strong>: Dữ liệu không có phân phối chuẩn</p>
<p>Vì p_value &lt; 2.2e-16, ta bác bỏ H0, dữ liệu không có phân phối chuẩn.</p>
</div>
</div>
<ul>
<li>Các nhóm có phương sai đồng nhất.<br>
</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(charges <span class="sc">~</span> <span class="fu">interaction</span>(sex,age,bmi,children,smoker,region), <span class="at">data =</span> data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
        Df F value    Pr(&gt;F)    
group  218  1.4416 0.0001271 ***
      1118                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Đặt Giả thuyết kiểm định thống kê ở các biến như sau:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>H0</strong>: Các nhóm có phương sai đồng nhất<br>
<strong>H1</strong>: Các nhóm có phương sai không đồng nhất</p>
<p>p_value = 0.07788 &gt; 0.05. Như vậy ta kết luận chấp nhận H0, <strong>phương sai đồng nhất</strong>.</p>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p><a href="https://www.geeksforgeeks.org/levenes-test-in-r-programming/">Link hướng dẫn thực hiện Levene’s Test</a></p>
</div></div><div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Kết luận
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dựa trên kết quả kiểm định các giả định như trên, ta đưa ra 3 hướng giải quyết:<br>
+ Tiếp tục thực hiện ANOVA nhiều nhân tố với giả định dữ liệu có phân phối chuẩn không thỏa mãn (với hy vọng rằng vi phạm này không ảnh hưởng quá nhiều đến kết quả).<br>
+ Thực hiện biến đổi biến để khắc phục. Sau đó thực hiện ANOVA.<br>
+ Thực hiện kiểm định thống kê phi tham số (nonparametric tests).</p>
</div>
</div>
<section id="thực-hiện-anova-mà-không-quan-tâm-đến-các-giả-định-không-thỏa-mãn." class="level4">
<h4 class="anchored" data-anchor-id="thực-hiện-anova-mà-không-quan-tâm-đến-các-giả-định-không-thỏa-mãn.">1. Thực hiện ANOVA mà không quan tâm đến các giả định không thỏa mãn.</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>nway_aov <span class="ot">&lt;-</span> <span class="cf">function</span>(dependent_variable, factor_list, data) {</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  formula <span class="ot">=</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(dependent_variable, <span class="st">"~"</span>, <span class="fu">paste</span>(factor_list, <span class="at">collapse =</span> <span class="st">"*"</span>)))</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">aov</span>(formula, <span class="at">data =</span> data)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">summary</span>(result))</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>dependent_variable <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"charges"</span>)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>factor_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"bmi"</span>, <span class="st">"children"</span>, <span class="st">"smoker"</span>, <span class="st">"region"</span>)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>n_way <span class="ot">=</span> <span class="fu">nway_aov</span>(dependent_variable, factor_list, <span class="at">data=</span>data2)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(n_way)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                 Df    Sum Sq   Mean Sq  F value   Pr(&gt;F)    
age                               2 1.338e+10 6.691e+09  194.756  &lt; 2e-16 ***
sex                               1 7.777e+08 7.777e+08   22.638 2.21e-06 ***
bmi                               2 4.199e+09 2.099e+09   61.104  &lt; 2e-16 ***
children                          2 1.210e+09 6.048e+08   17.604 2.97e-08 ***
smoker                            1 1.192e+11 1.192e+11 3470.182  &lt; 2e-16 ***
region                            3 1.213e+08 4.042e+07    1.177 0.317412    
age:sex                           2 1.387e+07 6.937e+06    0.202 0.817201    
age:bmi                           3 8.695e+07 2.898e+07    0.844 0.470042    
sex:bmi                           2 3.118e+07 1.559e+07    0.454 0.635301    
age:children                      4 6.843e+08 1.711e+08    4.980 0.000557 ***
sex:children                      2 3.347e+06 1.673e+06    0.049 0.952463    
bmi:children                      4 2.936e+08 7.340e+07    2.136 0.074260 .  
age:smoker                        2 5.333e+07 2.667e+07    0.776 0.460412    
sex:smoker                        1 3.930e+08 3.930e+08   11.440 0.000744 ***
bmi:smoker                        2 9.475e+09 4.738e+09  137.900  &lt; 2e-16 ***
children:smoker                   2 2.103e+07 1.051e+07    0.306 0.736408    
age:region                        6 1.023e+08 1.705e+07    0.496 0.811463    
sex:region                        3 1.522e+07 5.075e+06    0.148 0.931171    
bmi:region                        6 2.452e+08 4.087e+07    1.190 0.309217    
children:region                   6 2.663e+08 4.438e+07    1.292 0.258002    
smoker:region                     3 2.521e+08 8.404e+07    2.446 0.062443 .  
age:sex:bmi                       3 1.028e+08 3.426e+07    0.997 0.393369    
age:sex:children                  4 7.841e+07 1.960e+07    0.571 0.684064    
age:bmi:children                  6 1.700e+08 2.834e+07    0.825 0.550568    
sex:bmi:children                  4 9.603e+07 2.401e+07    0.699 0.592862    
age:sex:smoker                    2 3.122e+07 1.561e+07    0.454 0.635008    
age:bmi:smoker                    2 4.055e+06 2.028e+06    0.059 0.942695    
sex:bmi:smoker                    2 3.343e+08 1.671e+08    4.865 0.007879 ** 
age:children:smoker               4 5.127e+08 1.282e+08    3.731 0.005051 ** 
sex:children:smoker               2 1.500e+07 7.499e+06    0.218 0.803946    
bmi:children:smoker               4 1.944e+07 4.859e+06    0.141 0.966758    
age:sex:region                    6 5.245e+07 8.742e+06    0.254 0.957590    
age:bmi:region                    8 2.249e+08 2.811e+07    0.818 0.586461    
sex:bmi:region                    5 2.040e+08 4.080e+07    1.188 0.313052    
age:children:region              11 3.448e+08 3.135e+07    0.912 0.527477    
sex:children:region               6 5.002e+08 8.337e+07    2.427 0.024593 *  
bmi:children:region               7 1.490e+08 2.128e+07    0.619 0.740181    
age:smoker:region                 6 3.741e+08 6.235e+07    1.815 0.092924 .  
sex:smoker:region                 3 3.393e+08 1.131e+08    3.292 0.019998 *  
bmi:smoker:region                 5 7.402e+07 1.480e+07    0.431 0.827263    
children:smoker:region            6 5.681e+08 9.468e+07    2.756 0.011566 *  
age:sex:bmi:children              3 2.396e+07 7.985e+06    0.232 0.873819    
age:sex:bmi:smoker                2 9.966e+06 4.983e+06    0.145 0.865000    
age:sex:children:smoker           3 2.643e+08 8.810e+07    2.564 0.053345 .  
age:bmi:children:smoker           2 5.127e+07 2.564e+07    0.746 0.474411    
sex:bmi:children:smoker           2 3.361e+07 1.680e+07    0.489 0.613284    
age:sex:bmi:region                5 8.050e+07 1.610e+07    0.469 0.799795    
age:sex:children:region           7 1.233e+08 1.761e+07    0.513 0.825545    
age:bmi:children:region           5 2.202e+08 4.404e+07    1.282 0.269226    
sex:bmi:children:region           5 1.809e+08 3.618e+07    1.053 0.384893    
age:sex:smoker:region             6 3.184e+08 5.306e+07    1.544 0.160263    
age:bmi:smoker:region             4 1.253e+08 3.133e+07    0.912 0.456174    
sex:bmi:smoker:region             3 1.267e+08 4.222e+07    1.229 0.297874    
age:children:smoker:region        6 2.112e+08 3.520e+07    1.025 0.407460    
sex:children:smoker:region        5 5.459e+08 1.092e+08    3.178 0.007443 ** 
bmi:children:smoker:region        3 1.344e+08 4.481e+07    1.304 0.271560    
age:sex:children:smoker:region    1 2.443e+07 2.443e+07    0.711 0.399312    
age:bmi:children:smoker:region    1 1.100e+07 1.100e+07    0.320 0.571684    
Residuals                      1118 3.841e+10 3.436e+07                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Kết luận
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dựa vào bảng kết quả trên, ta rút được kết luận có sự tương tác giữa các biến: <code>age</code>:<code>bmi</code>:<code>children</code>:<code>smoker</code>:<code>region</code>.</p>
</div>
</div>
</section>
<section id="thực-hiện-biến-đổi-biến-sau-đó-thực-hiện-phân-tích-anova." class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="thực-hiện-biến-đổi-biến-sau-đó-thực-hiện-phân-tích-anova.">2. Thực hiện biến đổi biến, sau đó thực hiện phân tích ANOVA.</h4>
<p>Kiểm tra biến <code>charges</code> ta thấy có range = [1121.8739, 6.3770428^{4}], không có số âm. Ta quyết định thực hiện biến đổi biến theo phương pháp Box-Cox.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model <span class="ot">&lt;-</span> <span class="fu">powerTransform</span>(charges <span class="sc">~</span> ., <span class="at">data =</span> data2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>bcPower Transformation to Normality 
   Est Power Rounded Pwr Wald Lwr Bnd Wald Upr Bnd
Y1    0.1748        0.17       0.1247       0.2249

Likelihood ratio test that transformation parameter is equal to 0
 (log transformation)
                           LRT df       pval
LR test, lambda = (0) 46.19943  1 1.0681e-11

Likelihood ratio test that no transformation is needed
                           LRT df       pval
LR test, lambda = (1) 992.2174  1 &lt; 2.22e-16</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Likelihood ratio test that transformation parameters are equal to 0
</div>
</div>
<div class="callout-body-container callout-body">
<p>Để kiểm định việc có nên thực hiện phép biến đổi log-transformation với tất cả các biến hay không. Đặt giả thuyết:</p>
<p><strong>H0</strong>: Cần thực hiện phép biến đổi log-transformation cho tất cả các biến.<br>
<strong>H1</strong>: Không cần thực hiện phép biến đổi log-transformation cho tất cả các biến.<br>
Với p_value &lt; 2.5535e-15. Bác bỏ H0, <strong>ta không cần thực hiện phép biến đổi log-transformation cho tất cả các biến</strong>.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Likelihood ratio test that no transformations are needed
</div>
</div>
<div class="callout-body-container callout-body">
<p>Để kiểm định việc có nên thực hiện phép biến đổi biến hay không. Đặt giả thuyết:</p>
<p><strong>H0</strong>: Không cần thực hiện phép transformation.<br>
<strong>H1</strong>: Cần thực hiện tối thiểu một phép transformation.<br>
Với p_value &lt; 2.22e-16. Bác bỏ H0, ta <strong>cần thực hiện tối thiểu một phép transformation</strong>. Như vậy ta quyết định <strong>thực hiện biến đổi biến với biến Y</strong> với lambda được đề xuất (Rounded Pwr) = 0.2.</p>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>data2<span class="sc">$</span>charges <span class="ot">&lt;-</span> data2<span class="sc">$</span>charges<span class="sc">^</span>(<span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div><p>Thực hiện ANOVA</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>dependent_variable <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"charges"</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>factor_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"bmi"</span>, <span class="st">"children"</span>, <span class="st">"smoker"</span>, <span class="st">"region"</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>n_way <span class="ot">=</span> <span class="fu">nway_aov</span>(dependent_variable, factor_list, <span class="at">data=</span>data2)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(n_way)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                 Df Sum Sq Mean Sq  F value   Pr(&gt;F)    
age                               2  317.6   158.8  465.751  &lt; 2e-16 ***
sex                               1    1.4     1.4    4.179  0.04117 *  
bmi                               2   14.5     7.2   21.250 8.76e-10 ***
children                          2   22.8    11.4   33.489 7.49e-15 ***
smoker                            1  877.2   877.2 2573.049  &lt; 2e-16 ***
region                            3    4.9     1.6    4.837  0.00238 ** 
age:sex                           2    0.4     0.2    0.593  0.55270    
age:bmi                           3    0.3     0.1    0.327  0.80576    
sex:bmi                           2    1.0     0.5    1.487  0.22648    
age:children                      4   18.8     4.7   13.800 5.44e-11 ***
sex:children                      2    0.2     0.1    0.348  0.70629    
bmi:children                      4    1.2     0.3    0.886  0.47135    
age:smoker                        2   33.9    16.9   49.695  &lt; 2e-16 ***
sex:smoker                        1    2.9     2.9    8.439  0.00374 ** 
bmi:smoker                        2   24.8    12.4   36.413 4.78e-16 ***
children:smoker                   2    2.1     1.1    3.126  0.04429 *  
age:region                        6    1.2     0.2    0.594  0.73497    
sex:region                        3    0.0     0.0    0.030  0.99294    
bmi:region                        6    2.0     0.3    0.984  0.43435    
children:region                   6    2.5     0.4    1.246  0.28013    
smoker:region                     3    2.5     0.8    2.491  0.05884 .  
age:sex:bmi                       3    1.6     0.5    1.556  0.19852    
age:sex:children                  4    0.5     0.1    0.334  0.85504    
age:bmi:children                  6    2.0     0.3    0.971  0.44338    
sex:bmi:children                  4    0.7     0.2    0.478  0.75188    
age:sex:smoker                    2    0.7     0.3    1.017  0.36193    
age:bmi:smoker                    2    0.3     0.2    0.512  0.59955    
sex:bmi:smoker                    2    1.1     0.5    1.566  0.20938    
age:children:smoker               4    3.9     1.0    2.885  0.02156 *  
sex:children:smoker               2    0.0     0.0    0.038  0.96240    
bmi:children:smoker               4    0.1     0.0    0.105  0.98090    
age:sex:region                    6    0.4     0.1    0.190  0.97961    
age:bmi:region                    8    2.4     0.3    0.878  0.53407    
sex:bmi:region                    5    1.2     0.2    0.687  0.63304    
age:children:region              11    2.5     0.2    0.676  0.76274    
sex:children:region               6    2.5     0.4    1.245  0.28043    
bmi:children:region               7    1.2     0.2    0.517  0.82196    
age:smoker:region                 6    2.1     0.4    1.030  0.40414    
sex:smoker:region                 3    1.3     0.4    1.281  0.27940    
bmi:smoker:region                 5    0.4     0.1    0.234  0.94754    
children:smoker:region            6    2.0     0.3    0.958  0.45243    
age:sex:bmi:children              3    0.3     0.1    0.319  0.81150    
age:sex:bmi:smoker                2    0.2     0.1    0.354  0.70164    
age:sex:children:smoker           3    1.1     0.4    1.036  0.37554    
age:bmi:children:smoker           2    0.1     0.1    0.192  0.82498    
sex:bmi:children:smoker           2    0.1     0.1    0.167  0.84641    
age:sex:bmi:region                5    1.1     0.2    0.620  0.68495    
age:sex:children:region           7    1.2     0.2    0.482  0.84798    
age:bmi:children:region           5    1.7     0.3    0.994  0.42029    
sex:bmi:children:region           5    1.8     0.4    1.063  0.37904    
age:sex:smoker:region             6    1.5     0.2    0.720  0.63338    
age:bmi:smoker:region             4    1.0     0.3    0.763  0.54944    
sex:bmi:smoker:region             3    0.5     0.2    0.493  0.68731    
age:children:smoker:region        6    1.1     0.2    0.538  0.77954    
sex:children:smoker:region        5    1.3     0.3    0.754  0.58350    
bmi:children:smoker:region        3    0.9     0.3    0.859  0.46209    
age:sex:children:smoker:region    1    0.2     0.2    0.557  0.45574    
age:bmi:children:smoker:region    1    0.0     0.0    0.048  0.82579    
Residuals                      1118  381.2     0.3                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Dựa vào kết quả trên ta chọn các cặp nhân tố có sự tương tác với nhau: <code>age</code>, <code>children</code>, <code>smoker</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>dependent_variable <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"charges"</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>factor_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"children"</span>, <span class="st">"smoker"</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>n_way <span class="ot">=</span> <span class="fu">nway_aov</span>(dependent_variable, factor_list, <span class="at">data=</span>data2)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(n_way)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                      Df Sum Sq Mean Sq  F value   Pr(&gt;F)    
age                    2  317.6   158.8  440.481  &lt; 2e-16 ***
children               2   22.7    11.3   31.451 4.54e-14 ***
smoker                 1  880.8   880.8 2443.491  &lt; 2e-16 ***
age:children           4   18.0     4.5   12.449 6.07e-10 ***
age:smoker             2   33.3    16.7   46.201  &lt; 2e-16 ***
children:smoker        2    2.7     1.4    3.759   0.0236 *  
age:children:smoker    4    4.2     1.1    2.929   0.0200 *  
Residuals           1319  475.5     0.4                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
</section>
<section id="kiểm-tra-các-giả-định-của-mô-hình" class="level3">
<h3 class="anchored" data-anchor-id="kiểm-tra-các-giả-định-của-mô-hình">Kiểm tra các giả định của mô hình</h3>
<ul>
<li>Các nhóm phải có phân phối chuẩn hoặc gần chuẩn.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>av_residual <span class="ot">&lt;-</span> (<span class="fu">rstandard</span>(<span class="fu">aov</span>(data2<span class="sc">$</span>charges <span class="sc">~</span> data2<span class="sc">$</span>age <span class="sc">+</span> data2<span class="sc">$</span>children <span class="sc">+</span> data2<span class="sc">$</span>smoker)))</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(av_residual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  av_residual
W = 0.93199, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Đặt giả thuyết:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>H0</strong>: Dữ liệu có phân phối chuẩn<br>
<strong>H1</strong>: Dữ liệu không có phân phối chuẩn</p>
<p>Vì p_value &lt; 2.2e-16, ta bác bỏ H0, <strong>dữ liệu không có phân phối chuẩn</strong>.</p>
</div>
</div>
<ul>
<li>Các nhóm có phương sai đồng nhất.<br>
</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(charges <span class="sc">~</span> <span class="fu">interaction</span>(age,children,smoker), <span class="at">data =</span> data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
        Df F value    Pr(&gt;F)    
group   17  3.1767 1.315e-05 ***
      1319                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Đặt Giả thuyết kiểm định thống kê ở các biến như sau:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>H0</strong>: Các nhóm có phương sai đồng nhất<br>
<strong>H1</strong>: Các nhóm có phương sai không đồng nhất<br>
Sau khi thực hiện biến đổi biến Y và thực hiện kiểm định phương sai đồng nhất. <strong>Bác bỏ H0</strong> với p_value = 1.315e-05 &lt; 0.05.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Kết luận
</div>
</div>
<div class="callout-body-container callout-body">
<p>Phân tích ANOVA k nhân tố không phù hợp cho mô hình này vì không thỏa giả định phần dư tuân theo phân phối chuẩn cũng như có phương sai đồng nhất giữa các nhóm. Điều này có thể đến từ việc dữ liệu chưa thu thập đủ thông tin, cần phải thu thập nhiều dữ liệu hơn. Một phần kết quả trên của ta cũng chịu ảnh hưởng bởi cách phân chia các nhân tố (ở các biến <code>age</code>, <code>children</code>, <code>smoker</code>).</p>
</div>
</div>
</section>
<section id="đề-xuất-cải-tiếnphân-tích-khác-1" class="level3">
<h3 class="anchored" data-anchor-id="đề-xuất-cải-tiếnphân-tích-khác-1">Đề xuất cải tiến/phân tích khác</h3>
<p>Trong trường hợp với tập dữ liệu này, ta đề xuất sử dụng thống kê phi tham số cho các nhân tố ở các biến <code>age</code>, <code>children</code>, <code>smoker</code> với kiểm định Wilcox (biến có 2 nhân tố <code>smoker</code>) và Kruskal-Wallis Test (biến có 3 nhân tố- <code>age</code>, <code>children</code>). Sau đó tiến hành phân tích hậu định với package <code>FSA</code>.</p>
<p><strong>Biến <code>age</code></strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(charges <span class="sc">~</span> age, <span class="at">data =</span> data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Kruskal-Wallis rank sum test

data:  charges by age
Kruskal-Wallis chi-squared = 277.17, df = 2, p-value &lt; 2.2e-16</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dunnTest</span>(charges <span class="sc">~</span> age, <span class="at">data =</span> data2, <span class="at">method =</span> <span class="st">"holm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Dunn (1964) Kruskal-Wallis multiple comparison</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  p-values adjusted with the Holm method.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Comparison         Z      P.unadj        P.adj
1  30 &lt;= age &lt; 60 - age &lt; 30  13.81847 1.972231e-43 5.916692e-43
2 30 &lt;= age &lt; 60 - age &gt;= 60  -6.48719 8.745215e-11 8.745215e-11
3       age &lt; 30 - age &gt;= 60 -13.34023 1.350409e-40 2.700818e-40</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Đặt giả thuyết:
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>H0</strong>: Không có sự khác biệt giữa 3 nhóm tuổi<br>
<strong>H1</strong>: Có ít nhất 1 nhóm tuổi khác với 2 nhóm tuổi còn lại<br>
Với p-value &lt; 2.2e-16 &lt; 0.05. Bác bỏ H0, có ít nhất 1 nhóm tuổi khác với 2 nhóm tuổi còn lại.<br>
Thực hiện Dunn test, ta thấy được có sự khác biệt có ý nghĩa giữa từng nhóm tuổi với nhau.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="stats-modeling_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<p><strong>Biến <code>children</code></strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(charges <span class="sc">~</span> children, <span class="at">data =</span> data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Kruskal-Wallis rank sum test

data:  charges by children
Kruskal-Wallis chi-squared = 24.909, df = 2, p-value = 3.899e-06</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dunnTest</span>(charges <span class="sc">~</span> children, <span class="at">data =</span> data2, <span class="at">method =</span> <span class="st">"holm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Dunn (1964) Kruskal-Wallis multiple comparison</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  p-values adjusted with the Holm method.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Comparison          Z      P.unadj        P.adj
1 &gt; 2 childs - 0 or 1 child  4.1083720 3.984579e-05 0.0001195374
2     &gt; 2 childs - 2 childs  0.6344926 5.257594e-01 0.5257593765
3   0 or 1 child - 2 childs -3.5847237 3.374352e-04 0.0006748705</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-24-contents" aria-controls="callout-24" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Đặt giả thuyết:
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-24" class="callout-24-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>H0</strong>: Không có sự khác biệt giữa số lượng người phụ thuộc (con)<br>
<strong>H1</strong>: Có ít nhất 1 nhóm khác với 2 nhóm còn lại<br>
Với p-value = 3.899e-06 &lt; 0.05. Bác bỏ H0, có ít nhất 1 nhóm khác với 2 nhóm còn lại.<br>
Thực hiện Dunn test, ta thấy được có sự khác biệt có ý nghĩa giữa các nhóm <em>không có hoặc có 1 con</em> với nhóm <em>có 2 con trở lên</em>. Không có sự khác biệt có ý nghĩa giữa nhóm <em>có 2 con</em> và nhóm <em>có 2 con trở lên</em> với biến charges.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="stats-modeling_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<p><strong>Biến <code>smoker</code></strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(charges <span class="sc">~</span> smoker, <span class="at">data =</span> data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test with continuity correction

data:  charges by smoker
W = 7403, p-value &lt; 2.2e-16
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Đặt giả thuyết:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>H0</strong>: chi phí bảo hiểm của người hút thuốc và không hút thuốc bằng nhau<br>
<strong>H1</strong>: chi phí bảo hiểm giữa hai nhóm khác nhau Với p-value &lt; 2.2e-16 &lt; 0.05. Bác bỏ H0, kiểm định cho thấy có sự khác biệt giữa nhóm người hút thuốc và không hút thuốc đến biến charges.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="stats-modeling_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="hoạt-động-2" class="level1">
<h1>Hoạt động 2</h1>
<p>Tập dữ liệu sử dụng là tập <a href="https://www.kaggle.com/datasets/rafsunahmad/world-all-university-ranking-factors/data">Kaggle</a></p>
<section id="giới-thiệu-đề-đề-tài-nguồn-gốc-của-dữ-liệu-giới-thiệu-các-biến" class="level2">
<h2 class="anchored" data-anchor-id="giới-thiệu-đề-đề-tài-nguồn-gốc-của-dữ-liệu-giới-thiệu-các-biến">Giới thiệu đề “đề tài”, nguồn gốc của dữ liệu, giới thiệu các biến, …</h2>
<p>Dữ liệu xếp hàng đại học trên thế giới được nguồn từ <a href="https://www.kaggle.com/datasets/rafsunahmad/world-all-university-ranking-factors/data">Kaggle</a>. Đây là tập dữ liệu xếp hạng các trường đại học trên thế giới.<br>
Mục tiêu thực hiện: Sử dụng tập dữ liệu trên để <strong>dự báo điểm tổng xếp hạng (Overall Scores)</strong>. Theo ta đánh giá, đây là một tập dữ liệu thú vị và khó để dự đoán điểm tổng Overall, lí do là vì số điểm tổng Overall chính xác như một con số chỉ được quy ước cho các trường trong vòng TOP 200 hoặc khi điểm tổng đạt giá trị &gt; [55,60]. Khi điểm tổng thấp hơn thì bảng xếp hạng sẽ không còn để số điểm chính xác mà chỉ cho khoảng giá trị- <em>Vì cơ bản, bảng xếp hạng đại học này vốn được xây dựng cũng chỉ mang tính tham khảo tổng quát cho người sử dụng là người học, phụ huynh, doanh nghiệp</em>,… Ví dụ: Trường Michigan State University có <strong>hạng 50</strong> với điểm tổng là <strong>64.2</strong> trong khi trường University of Bayreuth có <strong>hạng 150</strong> sẽ có điểm tổng là trong khoảng <strong>47.4–49.2</strong>.</p>
<p>Căn cứ vào nguồn của <a href="https://www.timeshighereducation.com/student/advice/world-university-rankings-explained">THE Ranking</a>, ta có thể giải thích ý nghĩa các biến như sau:</p>
<table class="table">
<caption><strong>Tên biến dữ liệu</strong></caption>
<colgroup>
<col style="width: 20%">
<col style="width: 60%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Tên biến</th>
<th>Giải thích biến</th>
<th>Đổi tên biến thành</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>rank</td>
<td>Xếp hạng trường/viện</td>
<td>loại bỏ</td>
</tr>
<tr class="even">
<td>ranking-institution-title</td>
<td>Tên trường đại học/viện nghiên cứu</td>
<td>loại bỏ</td>
</tr>
<tr class="odd">
<td>location</td>
<td>Quốc gia</td>
<td>nation</td>
</tr>
<tr class="even">
<td>Overall scores</td>
<td>Điểm tổng</td>
<td>overall</td>
</tr>
<tr class="odd">
<td>Research Quality Score</td>
<td>Chỉ số về chất lượng nghiên cứu (ghi nhận chất lượng nghiên cứu như chỉ số trích dẫn, nội lực nghiên cứu và ảnh hưởng nghiên cứu ở trường/viện đến cộng đồng học thuật)</td>
<td>research_quality</td>
</tr>
<tr class="even">
<td>Industry Score</td>
<td>Chỉ số công nghiệp (ghi nhận tác động, thu nhập từ việc thương mại hóa các nghiên cứu, bằng sáng chế,…)</td>
<td>industry</td>
</tr>
<tr class="odd">
<td>International Outlook</td>
<td>Điểm quốc tế hóa (ghi nhận về tỉ lệ sinh viên quốc tế, nhân viên quốc tế và các hoạt động hợp tác quốc tế)</td>
<td>international</td>
</tr>
<tr class="even">
<td>Research Environment Score</td>
<td>Chỉ số về môi trường nghiên cứu (đo lường và ghi nhận điểm về danh tiếng học thuật, thu nhập từ hoạt động và sản phẩm nghiên cứu)</td>
<td>research_environment</td>
</tr>
<tr class="odd">
<td>Teaching Score</td>
<td>Chỉ số giảng dạy (ghi nhận điểm về danh tiếng giảng dạy, tỉ lệ giảng viên/sinh viên, tỉ lệ tiến sĩ/cử nhân,…)</td>
<td>teaching</td>
</tr>
</tbody>
</table>
<p>Vì dữ liệu được xếp hạng theo thứ tự, nên trước hết, ta quyết định xáo trộn dataset và đổi tên biến trước.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>data3 <span class="ot">&lt;-</span> data3[<span class="fu">sample</span>(<span class="fu">nrow</span>(data3)),]</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Đổi tên biến</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>data3 <span class="ot">&lt;-</span> data3 <span class="sc">%&gt;%</span> </span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">nation =</span> location, <span class="at">overall =</span> <span class="st">`</span><span class="at">Overall scores</span><span class="st">`</span>, </span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">research_quality =</span> <span class="st">`</span><span class="at">Research Quality Score</span><span class="st">`</span>, </span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">industry =</span> <span class="st">`</span><span class="at">Industry Score</span><span class="st">`</span>, <span class="at">international =</span> <span class="st">`</span><span class="at">International Outlook</span><span class="st">`</span>, </span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">research_environment =</span> <span class="st">`</span><span class="at">Research Environment Score</span><span class="st">`</span>, <span class="at">teaching =</span> <span class="st">`</span><span class="at">Teaching Score</span><span class="st">`</span>)</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "rank"                      "ranking-institution-title"
[3] "nation"                    "overall"                  
[5] "research_quality"          "industry"                 
[7] "international"             "research_environment"     
[9] "teaching"                 </code></pre>
</div>
</div>
<section id="tiền-xử-lý-số-liệu" class="level3">
<h3 class="anchored" data-anchor-id="tiền-xử-lý-số-liệu">Tiền xử lý số liệu</h3>
<p>Kiểm tra data profiling với lệnh <code>skim</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(data3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">data3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">910</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 30%">
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ranking-institution-title</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">910</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">nation</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">overall</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 21%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">rank</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">454.59</td>
<td style="text-align: right;">262.70</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">227.25</td>
<td style="text-align: right;">454.50</td>
<td style="text-align: right;">681.75</td>
<td style="text-align: right;">909.0</td>
<td style="text-align: left;">▇▇▇▇▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">research_quality</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">61.66</td>
<td style="text-align: right;">18.91</td>
<td style="text-align: right;">13.3</td>
<td style="text-align: right;">47.45</td>
<td style="text-align: right;">64.30</td>
<td style="text-align: right;">77.00</td>
<td style="text-align: right;">98.6</td>
<td style="text-align: left;">▂▅▆▇▃</td>
</tr>
<tr class="odd">
<td style="text-align: left;">industry</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">52.94</td>
<td style="text-align: right;">23.58</td>
<td style="text-align: right;">2.2</td>
<td style="text-align: right;">33.12</td>
<td style="text-align: right;">54.85</td>
<td style="text-align: right;">68.50</td>
<td style="text-align: right;">100.0</td>
<td style="text-align: left;">▃▅▅▇▃</td>
</tr>
<tr class="even">
<td style="text-align: left;">international</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">57.75</td>
<td style="text-align: right;">21.93</td>
<td style="text-align: right;">18.4</td>
<td style="text-align: right;">39.60</td>
<td style="text-align: right;">54.65</td>
<td style="text-align: right;">76.18</td>
<td style="text-align: right;">99.0</td>
<td style="text-align: left;">▅▇▆▅▆</td>
</tr>
<tr class="odd">
<td style="text-align: left;">research_environment</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.55</td>
<td style="text-align: right;">17.10</td>
<td style="text-align: right;">6.6</td>
<td style="text-align: right;">13.00</td>
<td style="text-align: right;">19.20</td>
<td style="text-align: right;">28.90</td>
<td style="text-align: right;">97.4</td>
<td style="text-align: left;">▇▃▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">teaching</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">25.25</td>
<td style="text-align: right;">15.44</td>
<td style="text-align: right;">6.7</td>
<td style="text-align: right;">15.80</td>
<td style="text-align: right;">20.20</td>
<td style="text-align: right;">28.98</td>
<td style="text-align: right;">98.2</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nhận xét:
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Dữ liệu có 910 quan sát và 9 biến (3 biến định dạng character và 6 biến dạng numeric).<br>
</li>
<li>Có 12 value ở biến <code>nation</code> bị khuyết. Sau khi làm điền giá trị khuyết, dựa vào tên quốc gia mà tạo nên biến mới <code>continent</code>: châu lục nhằm xây dựng mô hình thay sử dụng tên quốc gia.</li>
<li>Cần loại bỏ đi biến <code>rank</code> và <code>ranking-institution-title</code>.</li>
<li>Các biến <code>research_quality</code>, <code>industry</code>, <code>international</code>, <code>research_environment</code>, <code>teaching</code> có giá trị mean và median không quá chênh lệch nhau.</li>
</ul>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Tìm các giá trị bị thiếu tại biến `nation`</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>data3 <span class="sc">%&gt;%</span> </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(nation))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 9
    rank `ranking-institution-title`    nation overall research_quality industry
   &lt;dbl&gt; &lt;chr&gt;                          &lt;chr&gt;  &lt;chr&gt;              &lt;dbl&gt;    &lt;dbl&gt;
 1   890 Southern Federal University    &lt;NA&gt;   12.6–2…             29.9     18.1
 2   580 RUDN University                &lt;NA&gt;   31.3–3…             50.6     19.5
 3   885 Russian Presidential Academy … &lt;NA&gt;   12.6–2…             18.6     24.6
 4   679 ITMO University                &lt;NA&gt;   23.0–3…             56.3     41.8
 5   383 South Ural State University    &lt;NA&gt;   37.4–4…             91.3     19.3
 6   190 Peter the Great St Petersburg… &lt;NA&gt;   46.2–4…             72.1     24.2
 7   173 Ural Federal University        &lt;NA&gt;   47.4–4…             76.3     50  
 8    87 HSE University                 &lt;NA&gt;   58.1                54.7     69.7
 9    62 Lomonosov Moscow State Univer… &lt;NA&gt;   61.4                43.3     76.6
10   530 Financial University under th… &lt;NA&gt;   31.3–3…             38       46.2
11   686 Kazan Federal University       &lt;NA&gt;   23.0–3…             42       22.2
12   570 Plekhanov Russian University … &lt;NA&gt;   31.3–3…             35.1     34.3
# ℹ 3 more variables: international &lt;dbl&gt;, research_environment &lt;dbl&gt;,
#   teaching &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Nhận thấy đây là trường hợp đặc biệt, việc dữ liệu bị khuyết ở biến <code>nation</code> là do có chủ đích chứ không phải lí do khách quan làm dữ liệu bị khuyết (có thể là vì lí do chính trị). Các trường đại học có quốc gia bị khuyết này sau khi kiểm tra, đều thuộc Liên Bang Nga. Vì vậy, thay vì tìm giá trị mode để thay thế, ta quyết định điền giá trị khuyết bằng tên Russian.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Điền giá trị khuyết với tên Russian</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>data3 <span class="ot">&lt;-</span> data3 <span class="sc">%&gt;%</span> </span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nation =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(nation), <span class="st">'Russian'</span>, nation))</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Tạo biến continent với tên châu lục tương ứng với quốc gia</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>data3<span class="sc">$</span>continent <span class="ot">&lt;-</span> <span class="fu">countrycode</span>(<span class="at">sourcevar =</span> data3<span class="sc">$</span>nation, </span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">origin =</span> <span class="st">"country.name"</span>, </span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">destination =</span> <span class="st">"continent"</span>)</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a><span class="do">## bỏ đi biến rank, ranking-institution-title, nation</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>data3 <span class="ot">&lt;-</span> data3 <span class="sc">%&gt;%</span> </span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(rank, <span class="st">'ranking-institution-title'</span>, nation))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-27-contents" aria-controls="callout-27" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Xử lí và làm sạch biến <code>overall</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-27" class="callout-27-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Vì <code>overall</code> hiện tại có định dạng kí tự (character), cần được đổi về dạng số. Tuy nhiên, đối với các trường/viện nghiên cứu top dưới sẽ gây lỗi khi đổi về định dạng numeric. Một khó khăn khác là không thể để giá trị <code>mean</code> vì nhiều trường có cùng khoảng điểm <code>overall</code> như nhau. Một giải pháp đưa ra đó là: random ngẫu nhiên theo phân phối chuẩn với giá trị random sẽ nằm trong khoảng tương ứng mà khoảng điểm overall ban đầu cung cấp.<br>
Để đảm bảo thuận tiện cho việc sử dụng lại kết quả, chỉ thực hiện duy nhất một lần và lưu dữ liệu lại với tên là <code>ranking_cleaned.csv</code></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="do">## tạo biến overall_num để lưu các giá trị numeric</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="co"># data3$overall_num &lt;- as.numeric(data3$overall)</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="do">## tạo biến overcheck1 lưu chặng dưới</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="co"># data3$overcheck1 &lt;- substr(data3$overall, 1, 4)</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="co"># data3$overcheck1 &lt;- as.numeric(data3$overcheck1)</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="co"># data3$overcheck1[!is.na(data3$overall_num)] &lt;- NA</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a><span class="do">## tạo biến overcheck2 lưu chặng trên</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a><span class="co"># data3$overcheck2 &lt;- substr(data3$overall, 6, 9)</span></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a><span class="co"># data3$overcheck2 &lt;- as.numeric(data3$overcheck2)</span></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a><span class="do">## tạo giá trị với random có phân phối chuẩn trong khoảng (overcheck1, overcheck2)</span></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a><span class="co"># data3$overall_check &lt;- round(rtruncnorm(n=1,a=data3$overcheck1, b=data3$overcheck2),2)</span></span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a><span class="do">## merge overall_num và overall_check gán vào biến overall</span></span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a><span class="co"># data3$overall_num[is.na(data3$overall_num)] &lt;- data3$overall_check[is.na(data3$overall_num)]</span></span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a><span class="co"># data3$overall &lt;- data3$overall_num</span></span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a><span class="do">## xóa đi các biến đã thực hiện</span></span>
<span id="cb121-22"><a href="#cb121-22" aria-hidden="true" tabindex="-1"></a><span class="co"># data3 &lt;- data3 %&gt;% </span></span>
<span id="cb121-23"><a href="#cb121-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select(-c(overall_num, overcheck1, overcheck2, overall_check))</span></span>
<span id="cb121-24"><a href="#cb121-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-25"><a href="#cb121-25" aria-hidden="true" tabindex="-1"></a><span class="do">## lưu dataset với tên ranking_cleaned.csv</span></span>
<span id="cb121-26"><a href="#cb121-26" aria-hidden="true" tabindex="-1"></a><span class="co"># write_csv(data3, "./data/ranking_cleaned.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>data3_clean <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./data/ranking_cleaned.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 910 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): continent
dbl (6): overall, research_quality, industry, international, research_enviro...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Từ bước này, sử dụng <code>ranking_cleaned.csv</code> để tiếp tục thực hiện</p>
</div>
</div>
</div>
<p>Tạo biến giả cho biến <code>continent</code>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>data3_clean <span class="ot">&lt;-</span> <span class="fu">dummy_cols</span>(data3_clean, <span class="at">select_columns =</span> <span class="st">'continent'</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Loại bỏ biến continent sau khi tạo biến giả</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>data3_clean <span class="ot">&lt;-</span> <span class="fu">subset</span>(data3_clean, <span class="at">select =</span> <span class="sc">-</span>continent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Sau khi làm sạch dữ liệu như đã trình bày ở trên, ta có dữ liệu hoàn chỉnh về bảng xếp hạng đại học như sau:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  overall research_quality industry international research_environment teaching
    &lt;dbl&gt;            &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;                &lt;dbl&gt;    &lt;dbl&gt;
1    34.2             68.9     68.9          74.2                 14.6     19.9
2    34.2             77.4     38.3          37.4                 16.1     19.4
3    46.2             93.6     52.3          91.2                 22.2     21.3
4    31.3             70.8     52.4          46.1                 12       11.8
5    46.2             78       94.6          84.6                 33       19  
6    12.6             41.2     18.4          25.3                 12.9     10.7
# ℹ 5 more variables: continent_Africa &lt;int&gt;, continent_Americas &lt;int&gt;,
#   continent_Asia &lt;int&gt;, continent_Europe &lt;int&gt;, continent_Oceania &lt;int&gt;</code></pre>
</div>
</div>
<section id="nhận-xét-1" class="level5">
<h5 class="anchored" data-anchor-id="nhận-xét-1">Nhận xét</h5>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data3_clean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    overall      research_quality    industry      international  
 Min.   :12.60   Min.   :13.30    Min.   :  2.20   Min.   :18.40  
 1st Qu.:23.05   1st Qu.:47.45    1st Qu.: 33.12   1st Qu.:39.60  
 Median :34.22   Median :64.30    Median : 54.85   Median :54.65  
 Mean   :35.68   Mean   :61.66    Mean   : 52.94   Mean   :57.75  
 3rd Qu.:44.31   3rd Qu.:77.00    3rd Qu.: 68.50   3rd Qu.:76.17  
 Max.   :94.80   Max.   :98.60    Max.   :100.00   Max.   :99.00  
 research_environment    teaching     continent_Africa  continent_Americas
 Min.   : 6.60        Min.   : 6.70   Min.   :0.00000   Min.   :0.0000    
 1st Qu.:13.00        1st Qu.:15.80   1st Qu.:0.00000   1st Qu.:0.0000    
 Median :19.20        Median :20.20   Median :0.00000   Median :0.0000    
 Mean   :24.55        Mean   :25.25   Mean   :0.03407   Mean   :0.2297    
 3rd Qu.:28.90        3rd Qu.:28.98   3rd Qu.:0.00000   3rd Qu.:0.0000    
 Max.   :97.40        Max.   :98.20   Max.   :1.00000   Max.   :1.0000    
 continent_Asia  continent_Europe continent_Oceania
 Min.   :0.000   Min.   :0.000    Min.   :0.00000  
 1st Qu.:0.000   1st Qu.:0.000    1st Qu.:0.00000  
 Median :0.000   Median :0.000    Median :0.00000  
 Mean   :0.278   Mean   :0.411    Mean   :0.04725  
 3rd Qu.:1.000   3rd Qu.:1.000    3rd Qu.:0.00000  
 Max.   :1.000   Max.   :1.000    Max.   :1.00000  </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="stats-modeling_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Kiểm tra boxplot chung ở từng biến dữ liệu ta có được kết luận, về mặt bằng chung trên bảng xếp hạng, các trường đại học/viện nghiên cứu có các hoạt động về nghiên cứu (<code>research_quality</code>), công nghiệp (<code>industry</code>), quốc tế (<code>international</code>) có phân phối chuẩn (có thể lệch nhẹ) nhưng vẫn khá đối xứng khi xét thấy giá trị mean và median tương đối gần nhau- không chênh lệch quá nhiều.<br>
Tuy nhiên ta cũng thấy được các dữ liệu ngoại lai chủ yếu xuất hiện trên các biến <code>overall</code>, <code>research_environment</code>, <code>teaching</code>. Điều này là hợp lí khi chỉ có một số ít các trường đại học/viện nghiên cứu là nơi được tập trung nguồn lực để đào tạo và nghiên cứu phát triển công nghệ lõi, công nghệ mới, các yếu tố này đã thể hiện qua giá trị có điểm tổng, điểm môi trường nghiên cứu, giảng dạy vượt trội, outstanding hầu hết các trường/viện còn lại.<br>
<strong>Bộ dữ liệu nhìn chung được đánh giá là khách quan và thực tiễn</strong>.</p>
</div>
</div>
</section>
</section>
<section id="xây-dựng-mô-hình-hồi-quy-tuyến-tính-bộihoặc-anova-2-hay-nhiều-nhân-tố" class="level3">
<h3 class="anchored" data-anchor-id="xây-dựng-mô-hình-hồi-quy-tuyến-tính-bộihoặc-anova-2-hay-nhiều-nhân-tố">Xây dựng mô hình hồi quy tuyến tính bội/hoặc ANOVA 2 hay nhiều nhân tố</h3>
<section id="chia-thành-tập-train-và-tập-validation-với-tỉ-lệ-8020" class="level4">
<h4 class="anchored" data-anchor-id="chia-thành-tập-train-và-tập-validation-với-tỉ-lệ-8020">Chia thành tập train và tập validation với tỉ lệ 80:20</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Tạo id column</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>data3_clean<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data3_clean)</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="co">#sử dụng 80% cho tập training và 20% cho tập validation</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> data3_clean <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">sample_frac</span>(<span class="fl">0.8</span>)</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>val  <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">anti_join</span>(data3_clean, train, <span class="at">by =</span> <span class="st">'id'</span>)</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">subset</span>(train, <span class="at">select =</span> <span class="sc">-</span>id)</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>val <span class="ot">&lt;-</span> <span class="fu">subset</span>(val, <span class="at">select =</span> <span class="sc">-</span>id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="xây-dựng-mô-hình-hồi-quy-tuyến-tính-bội-với-tất-cả-các-biến" class="level4">
<h4 class="anchored" data-anchor-id="xây-dựng-mô-hình-hồi-quy-tuyến-tính-bội-với-tất-cả-các-biến">Xây dựng mô hình hồi quy tuyến tính bội với tất cả các biến</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(overall <span class="sc">~</span> ., <span class="at">data =</span> train)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = overall ~ ., data = train)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.5662 -1.2103  0.2276  1.3404 13.1211 

Coefficients: (1 not defined because of singularities)
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          -8.383919   0.558408 -15.014   &lt;2e-16 ***
research_quality      0.297673   0.005609  53.070   &lt;2e-16 ***
industry              0.057805   0.004660  12.404   &lt;2e-16 ***
international         0.104248   0.005229  19.938   &lt;2e-16 ***
research_environment  0.316059   0.014707  21.490   &lt;2e-16 ***
teaching              0.338660   0.015302  22.132   &lt;2e-16 ***
continent_Africa      0.352967   0.607556   0.581    0.561    
continent_Americas    0.256093   0.440488   0.581    0.561    
continent_Asia        0.284656   0.437447   0.651    0.515    
continent_Europe      0.251561   0.415399   0.606    0.545    
continent_Oceania           NA         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.281 on 718 degrees of freedom
Multiple R-squared:  0.9794,    Adjusted R-squared:  0.9791 
F-statistic:  3785 on 9 and 718 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Xây dựng mô hình hồi quy tuyến tính giữa overall và tất cả các biến
</div>
</div>
<div class="callout-body-container callout-body">
<p>Đặt giả thuyết:</p>
<ul>
<li><strong>H0</strong>: <span class="math inline">{\beta _i} = 0,\forall i</span><br>
</li>
<li><strong>H1</strong>: <span class="math inline">\exists {\beta _i} \ne 0</span><br>
Với p-value: &lt; 2.2e-16 ở kết quả trên, ta kết luận bác bỏ H0, tồn tại ít nhất 1 <span class="math inline">{\beta _i} \ne 0</span>. Vì vậy, ta xây dựng mô hình thứ 2, lần này chỉ có các biến có ý nghĩa với p_value &lt; 0.05: <code>research_quality</code>, <code>industry</code>, <code>international</code>, <code>research_environment</code>, <code>teaching</code><br>
<strong>Ngoài ra, khá bất ngờ khi vị trí địa lí của châu lục (có thể quốc gia sẽ có) lại không có ý nghĩa cho việc xây dựng mô hình dự báo điểm tổng cho chất lượng trường đại học/viện nghiên cứu</strong>.</li>
</ul>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>model_ranking <span class="ot">&lt;-</span> <span class="fu">lm</span>(overall <span class="sc">~</span> research_quality <span class="sc">+</span> industry </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">+</span> international <span class="sc">+</span> research_environment </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">+</span> teaching, <span class="at">data =</span> train)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_ranking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = overall ~ research_quality + industry + international + 
    research_environment + teaching, data = train)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.5672 -1.2178  0.2307  1.3492 13.0951 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          -8.084766   0.330797  -24.44   &lt;2e-16 ***
research_quality      0.297855   0.005567   53.51   &lt;2e-16 ***
industry              0.057675   0.004537   12.71   &lt;2e-16 ***
international         0.103106   0.004899   21.05   &lt;2e-16 ***
research_environment  0.315349   0.014374   21.94   &lt;2e-16 ***
teaching              0.339940   0.014909   22.80   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.276 on 722 degrees of freedom
Multiple R-squared:  0.9793,    Adjusted R-squared:  0.9792 
F-statistic:  6847 on 5 and 722 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model_ranking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    research_quality             industry        international 
            1.598503             1.536825             1.610942 
research_environment             teaching 
            7.953889             6.809575 </code></pre>
</div>
</div>
<p>Tuy mô hình cho <span class="math inline">R^2</span> có giá trị cao, nhưng xét thấy chỉ số VIF khi Kiểm tra đa cộng tuyến, ta thấy được biến <code>research_environment</code> có VIF &gt; 5 và vì R hiệu chỉnh(Adjusted R-squared): 0.9792 cho kết quả độ phù hợp của mô hình đã rất cao, ta quyết định loại bỏ biến <code>research_environment</code> ra khỏi mô hình và chạy lại.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>model_ranking <span class="ot">&lt;-</span> <span class="fu">lm</span>(overall <span class="sc">~</span> research_quality <span class="sc">+</span> industry </span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">+</span> international <span class="sc">+</span> teaching, <span class="at">data =</span> train)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_ranking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = overall ~ research_quality + industry + international + 
    teaching, data = train)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.3426 -1.8940  0.1449  2.0561 12.1564 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      -10.750037   0.396935  -27.08   &lt;2e-16 ***
research_quality   0.315180   0.007109   44.34   &lt;2e-16 ***
industry           0.090442   0.005526   16.36   &lt;2e-16 ***
international      0.108515   0.006312   17.19   &lt;2e-16 ***
teaching           0.629824   0.008908   70.71   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.936 on 723 degrees of freedom
Multiple R-squared:  0.9656,    Adjusted R-squared:  0.9654 
F-statistic:  5070 on 4 and 723 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model_ranking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>research_quality         industry    international         teaching 
        1.566333         1.370252         1.606861         1.460593 </code></pre>
</div>
</div>
<p>Ta tìm ra được mô hình phù hợp nhất.</p>
</section>
</section>
</section>
<section id="kiểm-tra-các-giả-định-của-mô-hình-đã-xây-dựng" class="level2">
<h2 class="anchored" data-anchor-id="kiểm-tra-các-giả-định-của-mô-hình-đã-xây-dựng">Kiểm tra các giả định của mô hình đã xây dựng</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">resid</span>(model_ranking))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  resid(model_ranking)
W = 0.99694, p-value = 0.1845</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
1. Kiểm tra sai số có tuân theo phân phối chuẩn hay không
</div>
</div>
<div class="callout-body-container callout-body">
<p>Đặt giả thuyết:</p>
<p><strong>H0</strong>: <span class="math inline">{\varepsilon _i}</span> có phân phối chuẩn<br>
<strong>H1</strong>: <span class="math inline">{\varepsilon _i}</span> không có phân phối chuẩn</p>
<p>Ta không bác bỏ H0, p-value = 0.1845 &gt; 0.05 <strong>sai số của mô hình có phân phối chuẩn</strong></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(<span class="fu">resid</span>(model_ranking), <span class="at">mu =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  resid(model_ranking)
t = -4.8245e-17, df = 727, p-value = 1
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 -0.2130196  0.2130196
sample estimates:
   mean of x 
-5.23485e-18 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
2. Kiểm tra giả định trung bình sai số <span class="math inline">\mu = 0</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Đặt giả thuyết:</p>
<p><strong>H0</strong>: <span class="math inline">{\rm E}({\varepsilon _i}) = 0</span><br>
<strong>H1</strong>: <span class="math inline">{\rm E}({\varepsilon _i}) \ne 0</span></p>
<p>p_value = 1, không bác bỏ H0. <strong>Trung bình sai số thỏa mãn</strong> <span class="math inline">{\rm E}({\varepsilon _i}) = 0</span></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncvTest</span>(model_ranking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 16.36199, Df = 1, p = 5.2324e-05</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
3. Kiểm tra tính ổn định của phương sai
</div>
</div>
<div class="callout-body-container callout-body">
<p>Đặt giả thuyết</p>
<p><strong>H0</strong>: phương sai không thay đổi<br>
<strong>H1</strong>: phương sai thay đổi</p>
<p>Ta bác bỏ H0 với p_value &lt; 5.2324e-05 &lt; 0.05. <strong>Mô hình không thỏa mãn tính ổn định của phương sai</strong>, phương sai của sai số thay đổi.</p>
</div>
</div>
<p><strong>Như vậy</strong>, mô hình không thỏa mãn tính ổn định của phương sai. Ta quyết định cần thực hiện các phép biến đổi biến (trasformation) với phương pháp Box-Cox và vì chỉ có duy nhất điều kiện 3 là tính ổn định của phương sai bị vi phạm, nên ta chọn kiểm tra liệu có nên biến đổi đối với biến phụ thuộc <code>overall</code> hay không.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model <span class="ot">&lt;-</span> <span class="fu">powerTransform</span>(overall <span class="sc">~</span> research_quality <span class="sc">+</span> industry </span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">+</span> international <span class="sc">+</span> teaching, <span class="at">data =</span> train))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>bcPower Transformation to Normality 
   Est Power Rounded Pwr Wald Lwr Bnd Wald Upr Bnd
Y1    1.0838        1.08       1.0272       1.1405

Likelihood ratio test that transformation parameter is equal to 0
 (log transformation)
                           LRT df       pval
LR test, lambda = (0) 752.5344  1 &lt; 2.22e-16

Likelihood ratio test that no transformation is needed
                           LRT df      pval
LR test, lambda = (1) 8.185991  1 0.0042215</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Likelihood ratio test that transformation parameters are equal to 0
</div>
</div>
<div class="callout-body-container callout-body">
<p>Để kiểm định việc có nên thực hiện phép biến đổi log-transformation với tất cả các biến hay không. Đặt giả thuyết:</p>
<p><strong>H0</strong>: Cần thực hiện phép biến đổi log-transformation cho tất cả các biến.<br>
<strong>H1</strong>: Không cần thực hiện phép biến đổi log-transformation cho tất cả các biến.<br>
Với p_value &lt; 2.22e-16. Bác bỏ H0, <strong>ta không cần thực hiện phép biến đổi log-transformation cho tất cả các biến</strong>.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Likelihood ratio test that no transformations are needed
</div>
</div>
<div class="callout-body-container callout-body">
<p>Để kiểm định việc có nên thực hiện phép biến đổi biến hay không. Đặt giả thuyết:</p>
<p><strong>H0</strong>: Không cần thực hiện phép transformation.<br>
<strong>H1</strong>: Cần thực hiện tối thiểu một phép transformation.<br>
Với p_value = 0.004 &lt; 0.05. Bác bỏ H0, ta <strong>cần thực hiện tối thiểu một phép transformation</strong>. Như vậy ta quyết định <strong>thực hiện biến đổi biến với biến Y</strong> với lambda được đề xuất (Rounded Pwr) = 1.08. và chọn đây là <strong>mô hình phù hợp nhất</strong></p>
</div>
</div>
</section>
<section id="chọn-mô-hình-phù-hợp-nhất" class="level2">
<h2 class="anchored" data-anchor-id="chọn-mô-hình-phù-hợp-nhất">Chọn mô hình phù hợp nhất</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>model_ranking <span class="ot">&lt;-</span> <span class="fu">lm</span>((overall)<span class="sc">^</span><span class="fl">1.08</span> <span class="sc">~</span> research_quality <span class="sc">+</span> industry </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">+</span> international <span class="sc">+</span> teaching, <span class="at">data =</span> train)</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_ranking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = (overall)^1.08 ~ research_quality + industry + international + 
    teaching, data = train)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.2928  -2.7123   0.2635   2.8333  16.9552 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      -18.720681   0.562147  -33.30   &lt;2e-16 ***
research_quality   0.445066   0.010068   44.21   &lt;2e-16 ***
industry           0.124853   0.007827   15.95   &lt;2e-16 ***
international      0.152519   0.008939   17.06   &lt;2e-16 ***
teaching           0.938471   0.012615   74.39   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.158 on 723 degrees of freedom
Multiple R-squared:  0.9671,    Adjusted R-squared:  0.9669 
F-statistic:  5314 on 4 and 723 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model_ranking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>research_quality         industry    international         teaching 
        1.566333         1.370252         1.606861         1.460593 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">resid</span>(model_ranking))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  resid(model_ranking)
W = 0.99754, p-value = 0.3572</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
1. Kiểm tra sai số có tuân theo phân phối chuẩn hay không
</div>
</div>
<div class="callout-body-container callout-body">
<p>Đặt giả thuyết:</p>
<p><strong>H0</strong>: <span class="math inline">{\varepsilon _i}</span> có phân phối chuẩn<br>
<strong>H1</strong>: <span class="math inline">{\varepsilon _i}</span> không có phân phối chuẩn</p>
<p>Ta không bác bỏ H0, p-value = 0.3572 &gt; 0.05 <strong>sai số của mô hình có phân phối chuẩn</strong></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(<span class="fu">resid</span>(model_ranking), <span class="at">mu =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  resid(model_ranking)
t = 1.834e-15, df = 727, p-value = 1
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 -0.3016825  0.3016825
sample estimates:
   mean of x 
2.818306e-16 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
2. Kiểm tra giả định trung bình sai số <span class="math inline">\mu = 0</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Đặt giả thuyết:</p>
<p><strong>H0</strong>: <span class="math inline">{\rm E}({\varepsilon _i}) = 0</span><br>
<strong>H1</strong>: <span class="math inline">{\rm E}({\varepsilon _i}) \ne 0</span></p>
<p>p_value = 1, không bác bỏ H0. <strong>Trung bình sai số thỏa mãn</strong> <span class="math inline">{\rm E}({\varepsilon _i}) = 0</span></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncvTest</span>(model_ranking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 9.973142, Df = 1, p = 0.0015884</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
3. Kiểm tra tính ổn định của phương sai
</div>
</div>
<div class="callout-body-container callout-body">
<p>Đặt giả thuyết</p>
<p><strong>H0</strong>: phương sai không thay đổi<br>
<strong>H1</strong>: phương sai thay đổi</p>
<p>Ta bác bỏ H0 với p_value = 0.0015884 &lt; 0.05. <strong>Mô hình không thỏa mãn tính ổn định của phương sai</strong>, phương sai của sai số thay đổi.</p>
</div>
</div>
<section id="phân-tích-kết-quả" class="level3">
<h3 class="anchored" data-anchor-id="phân-tích-kết-quả">Phân tích kết quả</h3>
<p>Dự báo trên tập validation và tính MSE trên tập validation.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_ranking, <span class="at">newdata =</span> val)</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Trả lại giá trị ban đầu</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> y_hat<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="fl">1.08</span>)</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>MSE <span class="ot">&lt;-</span> <span class="fu">mean</span>((val<span class="sc">$</span>overall <span class="sc">-</span> y_hat)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>MSE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.788576</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Kết luận với mô hình hồi quy
</div>
</div>
<div class="callout-body-container callout-body">
<p>Như vậy với R^2 hiệu chỉnh = 0.9669, mô hình có các biến độc lập giải thích được cho 96.69% sự biến thiên của biến phụ thuộc. Mô hình cũng không xảy ra hiện tượng đa cộng tuyến giữa các biến độc lập. Tuy nhiên, mô hình vẫn chưa thỏa mãn giả định về tính ổn định của phương sai.</p>
</div>
</div>
</section>
<section id="đưa-ra-những-phương-phápphân-tích-khác-có-thể-cho-kết-quả-tốt-hơn-nếu-có-thể" class="level3">
<h3 class="anchored" data-anchor-id="đưa-ra-những-phương-phápphân-tích-khác-có-thể-cho-kết-quả-tốt-hơn-nếu-có-thể">Đưa ra những phương pháp/phân tích khác có thể cho kết quả tốt hơn nếu có thể</h3>
<p>Tương tự, sử dụng Decision Tree, XGboost để thực hiện mô hình hóa và dự báo điểm tổng xếp hạng.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>tree_model <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">min_n=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(.,<span class="st">"regression"</span>)</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>tree_fit <span class="ot">&lt;-</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>  tree_model <span class="sc">%&gt;%</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(overall <span class="sc">~</span> ., <span class="at">data=</span>train)</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> </span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>  val <span class="sc">%&gt;%</span></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(overall) <span class="sc">%&gt;%</span></span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(tree_fit,val))</span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>MSE_tree <span class="ot">&lt;-</span> <span class="fu">mean</span>((result<span class="sc">$</span>overall <span class="sc">-</span> result<span class="sc">$</span>.pred)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a>MSE_tree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32.94434</code></pre>
</div>
</div>
<p>XGboost</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">=</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">search =</span> <span class="st">"grid"</span>)</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tạo thông số để thực hiện Grid search</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>gbmGrid <span class="ot">&lt;-</span>  <span class="fu">expand.grid</span>(<span class="at">max_depth =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>), </span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nrounds =</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)<span class="sc">*</span><span class="dv">50</span>,    <span class="co"># số lượng cây</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># cài đặt các value mặc định</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">eta =</span> <span class="fl">0.3</span>,</span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">gamma =</span> <span class="dv">0</span>,</span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">subsample =</span> <span class="dv">1</span>,</span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">min_child_weight =</span> <span class="dv">1</span>,</span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colsample_bytree =</span> <span class="fl">0.6</span>)</span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a><span class="co"># huấn luyện mô hình XGboost Regression tree model</span></span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> (<span class="fu">train</span>(overall<span class="sc">~</span>., </span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"xgbTree"</span>, </span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">trControl =</span> train_control, </span>
<span id="cb161-17"><a href="#cb161-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">tuneGrid =</span> gbmGrid, <span class="at">verbosity =</span> <span class="dv">0</span>))</span>
<span id="cb161-18"><a href="#cb161-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-19"><a href="#cb161-19" aria-hidden="true" tabindex="-1"></a><span class="co"># xuất kết quả mô hình tốt nhất cho XGboots</span></span>
<span id="cb161-20"><a href="#cb161-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>eXtreme Gradient Boosting 

728 samples
 10 predictor

No pre-processing
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 584, 582, 582, 583, 581 
Resampling results across tuning parameters:

  max_depth  nrounds  RMSE      Rsquared   MAE     
  3           50      2.762838  0.9690180  2.183960
  3          100      2.788751  0.9683503  2.202137
  3          150      2.801621  0.9680092  2.196372
  3          200      2.816418  0.9676235  2.202784
  3          250      2.830967  0.9673058  2.208084
  3          300      2.845155  0.9669351  2.221371
  3          350      2.852541  0.9667410  2.223868
  3          400      2.857310  0.9666252  2.228713
  3          450      2.861794  0.9664977  2.233753
  3          500      2.864747  0.9664219  2.236510
  5           50      2.827630  0.9676029  2.177772
  5          100      2.833594  0.9675080  2.165450
  5          150      2.840813  0.9673260  2.171368
  5          200      2.841330  0.9673085  2.169310
  5          250      2.841206  0.9673083  2.168583
  5          300      2.841656  0.9672959  2.169101
  5          350      2.841889  0.9672888  2.169331
  5          400      2.841910  0.9672878  2.169408
  5          450      2.841875  0.9672885  2.169405
  5          500      2.841875  0.9672885  2.169405
  7           50      2.909023  0.9657312  2.221195
  7          100      2.910594  0.9656935  2.219221
  7          150      2.910052  0.9657052  2.219263
  7          200      2.910104  0.9657032  2.219387
  7          250      2.910108  0.9657031  2.219397
  7          300      2.910108  0.9657031  2.219397
  7          350      2.910108  0.9657031  2.219397
  7          400      2.910108  0.9657031  2.219397
  7          450      2.910108  0.9657031  2.219397
  7          500      2.910108  0.9657031  2.219397

Tuning parameter 'eta' was held constant at a value of 0.3
Tuning

Tuning parameter 'min_child_weight' was held constant at a value of 1

Tuning parameter 'subsample' was held constant at a value of 1
RMSE was used to select the optimal model using the smallest value.
The final values used for the model were nrounds = 50, max_depth = 3, eta
 = 0.3, gamma = 0, colsample_bytree = 0.6, min_child_weight = 1 and subsample
 = 1.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>pred_y <span class="ot">=</span> <span class="fu">predict</span>(model, val)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="co"># performance metrics on the test data</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>test_y <span class="ot">=</span> val<span class="sc">$</span>overall</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>MSE_xgboots <span class="ot">&lt;-</span> <span class="fu">mean</span>((test_y <span class="sc">-</span> pred_y)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>MSE_xgboots</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.55082</code></pre>
</div>
</div>
<p>Như vậy trong tập dữ liệu này thì mô hình XGboost đã cho kết quả tốt hơn một chút (9.5508199 so với 9.788576)</p>
</section>
<section id="kết-luận-4" class="level3">
<h3 class="anchored" data-anchor-id="kết-luận-4">Kết luận</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Kết luận với bài toán dự đoán điểm xếp hạng đại học
</div>
</div>
<div class="callout-body-container callout-body">
<p>Theo cá nhân, đây là một bài toán khá thú vị và đa dạng cách để xử lí.<br>
Trước tiên, dữ liệu khuyết ở tập dữ liệu này được để khuyết một cách có chủ đích (bị bỏ đi tên quốc gia ở đây cụ thể là Nga). Tuy nhiên nhìn chung dữ liệu vẫn đảm bảo được tính khách quan, các giá trị outlier ở tập dữ liệu cũng đóng vai trò quan trọng khiến chúng không thể bị loại bỏ (vì các outlier này là các chỉ số thuộc các trường đại học/viện nghiên cứu hàng đầu nổi bật trong giảng dạy và nghiên cứu).<br>
Biến phụ thuộc mà ta chọn cũng khá đặc biệt khi một phần là điểm số cụ thể và một phần là các khoảng điểm để xếp hạng ranking gây khó khăn để tìm ra được cách xử lí.<br>
Một khó khăn khác với mô hình này đó là khác với task 1 (hoạt động 1) khi tính ổn định phương sai không thỏa mãn và có xuất hiện đa cộng tuyến.</p>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>